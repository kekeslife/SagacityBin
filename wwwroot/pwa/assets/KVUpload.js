import{d as P,m as I,u as T,s as y,h as F,e as o,b as c,F as V,i as S,r as i,o as k,j as C,V as D,k as R,l as G,n as $,v as j,c as H,p as J,q as Q}from"./vendor.js";import{$ as B}from"./axiosExt.js";const W=["multiple"],X={class:"w-100 h-100"},Y=P({__name:"KVUpload",props:I({upData:{type:Function},delData:{type:Function},preUpload:{type:Function},preDelete:{type:Function},upUrl:{type:String,required:!0},delUrl:{type:String,required:!0},multiple:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:I(["postUpload","postDelete"],["update:modelValue"]),setup(d,{emit:g}){const{showConfirm:_}=S("alert"),{lang:h}=S("lang"),u=T(d,"modelValue"),n=d,b=g,w=y(!1),U=y(""),m=y(null),q=async()=>{var t,l;if(((l=(t=m.value)==null?void 0:t.files)==null?void 0:l.length)!==0&&!(n.preUpload&&!await n.preUpload(m.value.files)))for(const r of m.value.files){const s=new FileReader;s.readAsDataURL(r),s.onload=a=>{var v;const e={src:(v=a.target)==null?void 0:v.result,state:"uploading",fileName:r.name},p=u.value.push(e);z(r,p)}}},z=async(t,l)=>{const r=new FormData;r.append("file",t);const s=u.value[l-1];if(n.upData){const a=n.upData(s);for(const e in a)r.append(e,a[e])}try{const e=(await B.post(n.upUrl,r)).data;if(e.isSuccess)s.state="success",b("postUpload",s,e);else throw e.message}catch{s.state="error"}},M=()=>{var t;(t=m.value)==null||t.click()},K=()=>{w.value=!1},L=t=>{U.value=t.src,w.value=!0},N=async t=>{const l=u.value[t];if(n.preDelete&&!await n.preDelete(l))return;if(!await new Promise((a,e)=>{_(h.value.util.确认删除,a)}))return!1;l.state="uploading";let s={};n.delData&&(s=n.delData(l));try{const e=(await B.post(n.delUrl,s,{headers:{"Content-Type":"application/json"}})).data;if(e.isSuccess){const p=u.value.splice(t,1);b("postDelete",p[0],e)}else throw e.message}catch{l.state="error"}};return(t,l)=>{const r=i("v-icon"),s=i("v-btn"),a=i("v-col"),e=i("v-progress-circular"),p=i("v-sheet"),v=i("v-row"),A=i("v-container"),E=i("v-fade-transition");return k(),F(V,null,[o(A,null,{default:c(()=>[o(v,null,{default:c(()=>[o(a,{cols:"4",sm:"3",md:"2",lg:"1"},{default:c(()=>[o(C(D),{"aspect-ratio":1,cover:"",class:"bg-grey-lighten-3"},{default:c(()=>[o(s,{onClick:M,class:"w-100 h-100 rounded-0",variant:"text"},{default:c(()=>[o(r,{size:"x-large",icon:"fas fa-plus"}),R("input",{ref_key:"$file",ref:m,onChange:q,multiple:n.multiple,type:"file",accept:"image/*",style:{display:"none"}},null,40,W)]),_:1})]),_:1})]),_:1}),(k(!0),F(V,null,G(u.value,(f,x)=>(k(),H(a,{key:x,class:"position-relative overflow-hidden",cols:"4",sm:"3",md:"2",lg:"1"},{default:c(()=>[o(C(D),{class:J(["border border-lg border-surface-light border-opacity-50",{"border-error":f.state==="error","border-success":f.state==="success"}]),"aspect-ratio":1,src:f.src,cover:"",onClick:O=>L(f)},{default:c(()=>[o(s,{size:"x-small",ripple:!1,class:"position-absolute pa-0 remove",variant:"tonal",icon:"fas fa-xmark",onClick:Q(O=>N(x),["stop"])},null,8,["onClick"]),$(R("div",X,[o(p,{class:"img-loading d-flex position-absolute top-0 bottom-0 w-100 h-100 align-center justify-center"},{default:c(()=>[o(e,{color:"primary",indeterminate:""})]),_:1})],512),[[j,f.state==="uploading"]])]),_:2},1032,["class","src","onClick"])]),_:2},1024))),128))]),_:1})]),_:1}),o(E,null,{default:c(()=>[$(o(p,{class:"position-fixed top-0 bottom-0 bg-white",style:{height:"100vh",width:"100vw","z-index":"2000"},onClick:K},{default:c(()=>[o(C(D),{class:"w-100 h-100",src:U.value},null,8,["src"])]),_:1},512),[[j,w.value]])]),_:1})],64)}}}),Z=(d,g)=>{const _=d.__vccOpts||d;for(const[h,u]of g)_[h]=u;return _},se=Z(Y,[["__scopeId","data-v-0052e1e0"]]);export{se as K,Z as _};
