import{d as P,m as I,u as T,s as y,h as F,e as o,b as c,F as V,i as S,r as u,o as k,j as C,V as D,k as R,l as G,n as $,v as j,c as H,p as J,q as Q}from"./vendor.js";import{$ as B}from"./axiosExt.js";const W=["multiple"],X={class:"w-100 h-100"},Y=P({__name:"KVUpload",props:I({upData:{type:Function},delData:{type:Function},preUpload:{type:Function},preDelete:{type:Function},upUrl:{type:String,required:!0},delUrl:{type:String,required:!0},multiple:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:I(["postUpload","postDelete"],["update:modelValue"]),setup(d,{emit:g}){const{showConfirm:_}=S("alert"),{lang:h}=S("lang"),i=T(d,"modelValue"),n=d,b=g,w=y(!1),U=y(""),m=y(null),M=async()=>{var t,l;if(((l=(t=m.value)==null?void 0:t.files)==null?void 0:l.length)!==0&&!(n.preUpload&&!await n.preUpload(m.value.files)))for(const r of m.value.files){const a=new FileReader;a.readAsDataURL(r),a.onload=s=>{var v;const e={src:(v=s.target)==null?void 0:v.result,state:"uploading",fileName:r.name},p=i.value.unshift(e);q(r,p)}}},q=async(t,l)=>{const r=new FormData;r.append("file",t);const a=i.value[Math.max(0,i.value.length-l)];if(n.upData){const s=n.upData(a);for(const e in s)r.append(e,s[e])}try{const e=(await B.post(n.upUrl,r)).data;if(e.isSuccess)a.state="success",b("postUpload",a,e);else throw e.message}catch{a.state="error"}},z=()=>{var t;(t=m.value)==null||t.click()},K=()=>{w.value=!1},L=t=>{U.value=t.src,w.value=!0},N=async t=>{const l=i.value[t];if(n.preDelete&&!await n.preDelete(l))return;if(!await new Promise((s,e)=>{_(h.value.util.确认删除,s)}))return!1;l.state="uploading";let a={};n.delData&&(a=n.delData(l));try{const e=(await B.post(n.delUrl,a,{headers:{"Content-Type":"application/json"}})).data;if(e.isSuccess){const p=i.value.splice(t,1);b("postDelete",p[0],e)}else throw e.message}catch{l.state="error"}};return(t,l)=>{const r=u("v-icon"),a=u("v-btn"),s=u("v-col"),e=u("v-progress-circular"),p=u("v-sheet"),v=u("v-row"),A=u("v-container"),E=u("v-fade-transition");return k(),F(V,null,[o(A,null,{default:c(()=>[o(v,null,{default:c(()=>[o(s,{cols:"4",sm:"3",md:"2",lg:"1"},{default:c(()=>[o(C(D),{"aspect-ratio":1,cover:"",class:"bg-grey-lighten-3"},{default:c(()=>[o(a,{onClick:z,class:"w-100 h-100 rounded-0",variant:"text"},{default:c(()=>[o(r,{size:"x-large",icon:"fas fa-plus"}),R("input",{ref_key:"$file",ref:m,onChange:M,multiple:n.multiple,type:"file",accept:"image/*",style:{display:"none"}},null,40,W)]),_:1})]),_:1})]),_:1}),(k(!0),F(V,null,G(i.value,(f,x)=>(k(),H(s,{key:x,class:"position-relative overflow-hidden",cols:"4",sm:"3",md:"2",lg:"1"},{default:c(()=>[o(C(D),{class:J(["border border-lg border-surface-light border-opacity-50",{"border-error":f.state==="error","border-success":f.state==="success"}]),"aspect-ratio":1,src:f.src,cover:"",onClick:O=>L(f)},{default:c(()=>[o(a,{size:"x-small",ripple:!1,class:"position-absolute pa-0 remove",variant:"tonal",icon:"fas fa-xmark",onClick:Q(O=>N(x),["stop"])},null,8,["onClick"]),$(R("div",X,[o(p,{class:"img-loading d-flex position-absolute top-0 bottom-0 w-100 h-100 align-center justify-center"},{default:c(()=>[o(e,{color:"primary",indeterminate:""})]),_:1})],512),[[j,f.state==="uploading"]])]),_:2},1032,["class","src","onClick"])]),_:2},1024))),128))]),_:1})]),_:1}),o(E,null,{default:c(()=>[$(o(p,{class:"position-fixed top-0 bottom-0 bg-white",style:{height:"100vh",width:"100vw","z-index":"2000"},onClick:K},{default:c(()=>[o(C(D),{class:"w-100 h-100",src:U.value},null,8,["src"])]),_:1},512),[[j,w.value]])]),_:1})],64)}}}),Z=(d,g)=>{const _=d.__vccOpts||d;for(const[h,i]of g)_[h]=i;return _},ae=Z(Y,[["__scopeId","data-v-3dc79484"]]);export{ae as K,Z as _};
