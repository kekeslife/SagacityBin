import{K as a,L as u,M as g}from"./vendor.js";import{$ as i}from"./axiosExt.js";import{E as n}from"./lang.js";const r=localStorage.getItem("userToken");let s;r&&(s=a(r));const c=u("storage",{state(){return{userId:s?s.UserId:null,userName:s?s.UserName:null,userToken:r,isLogged:!!r&&!!s.UserId,roles:s?s.Role.split(","):null,menuCollapsed:localStorage.getItem("menuCollapsed")===String(!0),lang:localStorage.getItem("lang")||n.english}},getters:{},actions:{async login(e,t){const o=await i.post("/api/authorize/login",{userId:parseInt(e).toString()==e?e:0,userName:e,password:t});if(o.data.isSuccess){this.userId=o.data.record.userId.toString(),this.userName=o.data.record.userName.toString(),this.userToken=o.headers.authorization,this.isLogged=!0;let l=a(this.userToken);this.roles=l?l.Role.split(","):null,localStorage.setItem("userToken",this.userToken)}else throw o.data.message},logout(){this.userId=null,this.userName=null,this.userToken=null,this.isLogged=!1,this.roles=null,this.lang=n.english,localStorage.removeItem("userToken"),localStorage.removeItem("lang"),localStorage.removeItem("menuCollapsed")},async refreshToken(){if(!this.userToken){this.isLogged=!1;return}const e=await i.get(`/api/authorize/refresh/${this.userId}`);if(e.data.isSuccess){this.userToken=e.data.record;const t=a(this.userToken);this.userId=t.UserId,this.userName=t.UserName,this.roles=t.Role.split(","),this.isLogged=!0,localStorage.setItem("userToken",this.userToken)}else throw e.data.message},setMenuCollapsed(e){this.menuCollapsed=e,localStorage.setItem("menuCollapsed",String(e))},setLang(e){this.lang=e,localStorage.setItem("lang",e),g.set("lang",e,{sameSite:"strict"})}}});export{c as u};
