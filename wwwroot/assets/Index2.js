import{c as g,a as p,d,b as h,e as m,f,g as l,t as S,h as k,F as _,r as I,o as T}from"./vendor.js";const x=g();var n=(e=>(e[e.Success=0]="Success",e[e.AuthenticateFailure=401]="AuthenticateFailure",e[e.AuthenticateTokenExpired=402]="AuthenticateTokenExpired",e[e.AuthenticateForbidden=403]="AuthenticateForbidden",e[e.Other=500]="Other",e))(n||{});let o;const r=p.create();r.interceptors.request.use(e=>{o||(o=L(x));const s=o.userToken;return e.headers.Authorization=`Bearer ${s}`,e},e=>Promise.reject(e.data.error.message));r.interceptors.response.use(e=>e,async e=>{var t;const s=e.config;if(((t=e.response)==null?void 0:t.status)===401&&e.response.data)if(e.response.data.code===n.AuthenticateTokenExpired)try{return await o.refreshToken(),o.isLogged?await r(s):(e.response.data={isSuccess:!1,message:"请重新登录",code:n.Success},e.response)}catch{return o.isLogged=!1,e.response.data={isSuccess:!1,message:"刷新失败，请重新登录",code:n.Success},e.response}else return o.isLogged=!1,e.response.data={isSuccess:!1,message:"刷新失败，请重新登录",code:n.Success},e.response;return e.response.data={isSuccess:!1,message:e.message,code:n.Success},e.response});const i=localStorage.getItem("userToken");let a;i&&(a=d(i));const L=h("storage",{state(){return{userId:a?a.UserId:null,userName:a?a.UserName:null,userToken:i,isLogged:!!i&&!!a.UserId,roles:a?a.Role.split(","):null,menuCollapsed:localStorage.getItem("menuCollapsed")===String(!0),lang:localStorage.getItem("lang")||"CN"}},getters:{},actions:{async login(e,s){const t=await r.post("/api/authorize/login",{userName:e,password:s,roles:""});if(t.data.isSuccess)this.userId=t.data.record.userId.toString(),this.userName=t.data.record.userName.toString(),this.userToken=t.headers.authorization,this.isLogged=!0,this.roles=t.data.record.roles.split(","),localStorage.setItem("userToken",this.userToken);else throw t.data.message},logout(){this.userId=null,this.userName=null,this.userToken=null,this.isLogged=!1,this.roles=null,localStorage.removeItem("userToken")},async refreshToken(){if(!this.userToken){this.isLogged=!1;return}const e=await r.get(`/api/authorize/refresh/${this.userId}`);if(e.data.isSuccess){this.userToken=e.data.record;const s=d(this.userToken);this.userId=s.UserId,this.userName=s.UserName,this.roles=s.Role.split(","),this.isLogged=!0,localStorage.setItem("userToken",this.userToken)}else throw e.data.message},setMenuCollapsed(e){this.menuCollapsed=e,localStorage.setItem("menuCollapsed",String(e))},setLang(e){this.lang=e,localStorage.setItem("lang",e)}}}),N=(e,s)=>{const t=e.__vccOpts||e;for(const[c,u]of s)t[c]=u;return t},w=m({__name:"Index",setup(e){const s=()=>{r.get("api/test/test/fromVite")};return(t,c)=>{const u=I("a-date-picker");return T(),f(_,null,[l("h1",null,S(new Date().toLocaleString()),1),l("button",{onClick:s},"test12"),k(u)],64)}}}),y=N(w,[["__scopeId","data-v-72e607f3"]]),b=Object.freeze(Object.defineProperty({__proto__:null,default:y},Symbol.toStringTag,{value:"Module"}));export{r as $,b as I,N as _,x as p,L as u};
