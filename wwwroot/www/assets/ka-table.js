import{d as me,cc as et,cd as qt,ce as Ce,cf as tt,j as x,o as D,c as j,w as d,cg as Ht,m as Te,r as N,n as Je,ch as de,ci as Ie,F as xe,cj as ge,ck as Jt,cl as Le,f,cm as Ve,cn as qe,co as Kt,l as ne,u as O,cp as Ne,bN as Wt,cq as Xt,cr as be,bR as he,cs as Gt,ct as Z,bO as it,cu as Qt,cv as He,cw as Zt,t as ae,cx as eo,cy as to,cz as oo,cA as ye,cB as Fe,cC as ao,e as De,cD as no,k as fe,v as pe,cE as ot,cF as lo,cG as ro,h as Ye,z as so,cH as at,cI as je,cJ as nt,s as io,cK as co,A as uo,cL as fo,cM as po}from"./vendor.js";import{I as yo,T as mo,a as vo,D as ho,S as bo,b as Ue,t as go}from"./ant-design-vue.js";import{_ as ze}from"./Home.js";const lt=o=>{const c=[],r=[];Object.keys(o).forEach(i=>{r.push(o[i])}),r.sort((i,y)=>i.index-y.index);let e=null;for(let i of r)i.position==="line"||i.position==null||e===null?(e=[[i]],c.push(e)):i.position==="inline"?e.push([i]):i.position==="cling"&&e[e.length-1].push(i);return c},$e=me({__name:"KaInput",props:et({valueConverter:{type:Function},componentType:{type:String,default:"input"},customComponent:{type:Object},debounceDelay:{type:Number,default:300}},{modelValue:{},modelModifiers:{}}),emits:et(["change","search"],["update:modelValue"]),setup(o,{emit:c}){const r=qt(o,"modelValue"),a=c,e=o,i={input:Ce(yo),textarea:Ce(mo),number:Ce(vo),date:Ce(ho),select:Ce(bo)},y=tt(A=>{console.log("onSearchDebounce"),A&&a("search",A)},e.debounceDelay),p=tt(async(A,B)=>{await v(A,B)},e.debounceDelay),v=async(A,B)=>{e.valueConverter&&(A=await e.valueConverter(A)),a("change",A,B)},P=async(A,B)=>{if(A instanceof Event&&(A=A.target.value),e.debounceDelay===0||["date","select"].includes(e.componentType)){await v(A,B);return}p(A,B)},q=A=>{y(A)};return(A,B)=>{const S=x("a-config-provider");return D(),j(S,{theme:{token:{colorTextDisabled:"#00000088"}}},{default:d(()=>[(D(),j(Ht(e.customComponent||i[o.componentType]),Te({value:r.value,"onUpdate:value":B[0]||(B[0]=u=>r.value=u)},A.$attrs,{onChange:P,onSearch:q,"show-search":"","allow-clear":"",class:"ka-input"}),null,16,["value"]))]),_:1})}}}),_o=me({__name:"KaEditor",props:{itemsObj:{type:Object,required:!0}},setup(o,{expose:c}){const r=o,a=N(null),e=N([]),i=N({}),y=()=>{e.value=lt(r.itemsObj)},p=async(g,k,z)=>{k.onAfterChange&&await k.onAfterChange(g,z)},v=async(g,k)=>{Ve(k.options)&&k.attrs&&(k.attrs.options=await k.options(g))};return c({reRender:y,getEditorVal:g=>g?i.value[g]:i.value,setEditorVal:async(g,k,z=!0,U=!1)=>{if(g){i.value[g]=k,U&&await v(k,r.itemsObj[g]),z&&await p(k,r.itemsObj[g]);try{await a.value.validateFields(g)}catch{}}},clearEditor:()=>{for(const g in i.value)i.value[g]=null;a.value.resetFields()},resetFields:g=>a.value.resetFields(g),clearValidate:g=>a.value.clearValidate(g),validate:(g,k)=>a.value.validate(g,k),validateFields:(g,k)=>a.value.validateFields(g,k),scrollToField:(g,k)=>a.value.scrollToField(g,k)}),Je(()=>{e.value=lt(r.itemsObj)}),(g,k)=>{const z=x("a-form-item-rest"),U=x("a-input-group"),ee=x("a-form-item"),l=x("a-form");return D(),j(l,{ref_key:"$form",ref:a,model:i.value,layout:"vertical"},{default:d(()=>[(D(!0),de(xe,null,Ie(e.value,(_,C)=>(D(),de("div",{class:"editor-row",key:C,style:ge({display:Jt(_,2).some(V=>V.display!=="hide")?"flex":"none"})},[(D(!0),de(xe,null,Ie(_,(V,K)=>(D(),j(ee,{key:K,label:V[0].title,rules:V[0].rules,name:V[0].key,class:Le([{hide:V[0].display==="hide"},"item-flex"])},{default:d(()=>[f(U,{compact:V.length>1},{default:d(()=>[(D(!0),de(xe,null,Ie(V,(I,$)=>(D(),de(xe,{key:$},[$===0?(D(),j($e,Te({key:0,style:{width:I.width,display:I.display==="hide"?"none":"auto"},modelValue:i.value[I.key],"onUpdate:modelValue":R=>i.value[I.key]=R,ref_for:!0},I.attrs,{"component-type":I.componentType,"value-converter":I.valueConverter,"custom-component":I.customComponent,"debounce-delay":I.debounceDelay,disabled:I.display==="readonly",onChange:(R,le)=>{p(R,I,le)},onSearch:R=>{v(R,I)},size:"normal"}),null,16,["style","modelValue","onUpdate:modelValue","component-type","value-converter","custom-component","debounce-delay","disabled","onChange","onSearch"])):(D(),j(z,{key:1},{default:d(()=>[f($e,Te({style:{width:I.width,display:I.display==="hide"?"none":"auto"},modelValue:i.value[I.key],"onUpdate:modelValue":R=>i.value[I.key]=R,ref_for:!0},I.attrs,{"component-type":I.componentType,"value-converter":I.valueConverter,"custom-component":I.customComponent,"debounce-delay":I.debounceDelay,disabled:I.display==="readonly",onChange:(R,le)=>{p(R,I,le)},onSearch:R=>{v(R,I)},size:"normal"}),null,16,["style","modelValue","onUpdate:modelValue","component-type","value-converter","custom-component","debounce-delay","disabled","onChange","onSearch"])]),_:2},1024))],64))),128))]),_:2},1032,["compact"])]),_:2},1032,["label","rules","name","class"]))),128))],4))),128))]),_:1},8,["model"])}}}),wo=ze(_o,[["__scopeId","data-v-ef9ade20"]]),Se=()=>({key:"",val:"",bool:"and"}),ko=me({__name:"KaFilter",props:{columns:{type:Array,required:!0},items:{type:Array,default:[Se()]}},setup(o,{expose:c}){const r=o,a=N(r.items);let e=[];const i=[{label:"等于",value:"eq"},{label:"不等于",value:"neq"},{label:"大于",value:"gt"},{label:"大于等于",value:"gte"},{label:"小于",value:"lt"},{label:"小于等于",value:"lte"},{label:"开头于",value:"beg"},{label:"结束于",value:"end"},{label:"包含",value:"like"},{label:"空",value:"nu"},{label:"不为空",value:"nnu"}],y=(l,_)=>{console.log("onChangeCol"),l.col=r.columns.find(C=>C.key===l.key),l.opt=void 0,l.optOptions=q(l),l.val="",l.valOptions=void 0,l.valComponent=void 0,l.valAttrs=void 0},p=(l,_)=>{var K,I,$,R,le,se,M,W,T;if(console.log("onChangeOpt"),!_)return;let C=be(l.val)?l.val[0]:l.val,V=be(l.val)?l.val:l.val==null||l.val==""?[]:[l.val];if(C instanceof he&&(C=C.format(((I=(K=l.col)==null?void 0:K.attrs)==null?void 0:I.format)||"YYYY-MM-DD"),V[0]=C),["beg","end"].includes(_)){l.valComponent="input",l.val=C,l.valOptions=void 0,l.valAttrs=void 0;return}if(["nu","nnu"].includes(_)){l.valComponent="input",l.val="",l.valOptions=void 0,l.valAttrs=void 0;return}if(["eq","neq","gt","gte","lt","lte","like"].includes(_)&&l.col.options){l.valComponent="select",l.valOptions=be(($=l.col)==null?void 0:$.options)?(R=l.col)==null?void 0:R.options:void 0,l.valAttrs=((le=l.col)==null?void 0:le.attrs)||{},l.val=((se=l.valAttrs)==null?void 0:se.mode)==="combobox"?C:V,P(l,C);return}l.col.componentType==="textarea"?l.valComponent="input":l.valComponent=l.col.componentType,l.valComponent==="number"?l.val=parseFloat(C)||null:l.valComponent==="date"?l.val=C?he(C,((W=(M=l.col)==null?void 0:M.attrs)==null?void 0:W.format)||"YYYY-MM-DD"):null:l.val=C,l.valAttrs=(T=l.col)==null?void 0:T.attrs,l.valOptions=void 0},v=(l,_)=>{var C;console.log("onValChange",_),(C=l.col)!=null&&C.valueConverter&&(l.val=_)},P=async(l,_)=>{var C;Ve((C=l.col)==null?void 0:C.options)&&(l.valOptions=await l.col.options(_))},q=l=>{var _,C,V,K,I;return((_=l.col)==null?void 0:_.componentType)==="number"?i.filter($=>["eq","neq","gt","gte","lt","lte","in","nu","nnu"].includes($.value)):((C=l.col)==null?void 0:C.componentType)==="date"?i.filter($=>["eq","neq","gt","gte","lt","lte","nu","nnu"].includes($.value)):((V=l.col)==null?void 0:V.componentType)==="select"&&((I=(K=l.col)==null?void 0:K.attrs)==null?void 0:I.mode)==="multiple"?i.filter($=>["eq","neq","like","nu","nnu"].includes($.value)):i},A=()=>({key:"",val:"",bool:"and",children:[Se()]}),B=l=>{a.value.splice(l,0,Se())},S=l=>{a.value.splice(l+1,0,Se())},u=l=>{a.value.splice(l,0,A())},b=l=>{a.value.splice(l+1,0,A())},G=l=>{a.value.splice(l,1)},g=l=>{if(console.log("setConditions"),l.length===0){a.value=[Se()];return}l[0].bool="and";const _=[];for(const C of l)_.push(k(C));a.value=_},k=l=>{const _={...l};if(l.children){_.children=[];for(const C of l.children)_.children.push(k(C))}else _.col=r.columns.find(C=>C.key===_.key),_.optOptions=q(_),p(_,_.opt);return _},z=()=>U(a.value),U=l=>{const _=[];for(const C of l){const V=qe(Kt(C,["key","opt","val","bool"]));C.children&&(V.children=U(C.children)),_.push(V)}return _},ee=l=>{l?e=l.map(_=>({label:_.title,value:_.key})):e=r.columns.map(_=>({label:_.title,value:_.key}))};return c({setConditions:g,getConditions:z,render:ee}),Je(()=>{ee()}),(l,_)=>{const C=x("a-select-option"),V=x("a-select"),K=x("ka-filter",!0),I=x("a-space-compact"),$=x("a-menu-item"),R=x("a-menu-divider"),le=x("a-menu"),se=x("a-button"),M=x("a-dropdown"),W=x("a-flex");return D(),j(W,{vertical:"vertical",gap:"small"},{default:d(()=>[(D(!0),de(xe,null,Ie(a.value,(T,H)=>(D(),j(W,{gap:"small",class:"katable-filter",key:H},{default:d(()=>[f(V,{class:"bool",value:T.bool,"onUpdate:value":te=>T.bool=te,"show-arrow":!1,"popup-class-name":"katable-filter-bool-popup",style:ge({visibility:H===0?"hidden":void 0}),size:"nomal"},{default:d(()=>[f(C,{value:"and"},{default:d(()=>[ne("且")]),_:1}),f(C,{value:"or"},{default:d(()=>[ne("或")]),_:1})]),_:2},1032,["value","onUpdate:value","style"]),T.children?(D(),j(K,{key:0,class:"child",items:T.children,columns:r.columns},null,8,["items","columns"])):(D(),j(I,{key:1,class:"flex-auto-width"},{default:d(()=>{var te,ie;return[f(V,{class:"col",value:T.key,"onUpdate:value":Y=>T.key=Y,"show-arrow":!1,options:O(e),onChange:Y=>{y(T,Y)},size:"nomal"},null,8,["value","onUpdate:value","options","onChange"]),f(V,{class:"opt","show-arrow":!1,value:T.opt,"onUpdate:value":Y=>T.opt=Y,options:T.optOptions,onChange:Y=>{p(T,Y)},disabled:!T.key,size:"nomal"},null,8,["value","onUpdate:value","options","onChange","disabled"]),f($e,Te({modelValue:T.val,"onUpdate:modelValue":Y=>T.val=Y,"component-type":T.valComponent,ref_for:!0},T.valAttrs,{"value-converter":(te=T.col)==null?void 0:te.valueConverter,"debounce-delay":(ie=T.col)==null?void 0:ie.debounceDelay,disabled:!T.opt||T.opt==="nu"||T.opt==="nnu",onChange:Y=>{v(T,Y)},onSearch:Y=>{P(T,Y)},options:T.valOptions,class:"flex-auto-width",style:{flex:"1"}}),null,16,["modelValue","onUpdate:modelValue","component-type","value-converter","debounce-delay","disabled","onChange","onSearch","options"])]}),_:2},1024)),f(M,{size:"nomal"},{overlay:d(()=>[f(le,null,{default:d(()=>[f($,{key:"1",onClick:te=>S(H)},{default:d(()=>[f(O(Ne))]),_:2},1032,["onClick"]),f($,{key:"2",onClick:te=>B(H),class:"katable-filter-action-rvs"},{default:d(()=>[f(O(Ne))]),_:2},1032,["onClick"]),f(R),f($,{key:"3",onClick:te=>b(H)},{default:d(()=>[f(O(Ne),{class:"katable-filter-action-grp"})]),_:2},1032,["onClick"]),f($,{key:"4",onClick:te=>u(H),class:"katable-filter-action-rvs"},{default:d(()=>[f(O(Ne),{class:"katable-filter-action-grp"})]),_:2},1032,["onClick"]),f(R),f($,{disabled:H===0&&a.value.length===1,key:"5",onClick:te=>G(H)},{default:d(()=>[f(O(Wt))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:d(()=>[f(se,{size:"nomal"},{default:d(()=>[f(O(Xt))]),_:1})]),_:2},1024)]),_:2},1024))),128))]),_:1})}}}),Co=ze(ko,[["__scopeId","data-v-db478202"]]),So=()=>({size:{type:String,default:"small"},refresh:{type:Object,default:()=>({isShow:!0,title:"刷新",isActive:!1,isDisabled:!1})},filter:{type:Object,default:()=>({isShow:!0,title:"筛选",isActive:!1,isDisabled:!1})},sort:{type:Object,default:()=>({isShow:!0,title:"排序",isActive:!1,isDisabled:!1})},add:{type:Object,default:()=>({isShow:!0,title:"新增",isActive:!1,isDisabled:!1})},edit:{type:Object,default:()=>({isShow:!0,title:"编辑",isActive:!1,isDisabled:!1})},remove:{type:Object,default:()=>({isShow:!0,title:"删除",isActive:!1,isDisabled:!1})},export:{type:Object,default:()=>({isShow:!0,title:"导出",isActive:!1,isDisabled:!1})},import:{type:Object,default:()=>({isShow:!0,title:"导入",isActive:!1,isDisabled:!1})},activateColor:{type:String,default:"#1677ff"}}),xo=me({__name:"KaToolbar",props:So(),setup(o,{expose:c}){const r={style:{borderRadius:"6px"}},a=o,e=N([]),i=y=>(e.value=[y],a.import.beforeUpload&&a.import.beforeUpload(y),!1);return c({getFileList:()=>e.value}),(y,p)=>{const v=x("a-button"),P=x("a-tooltip"),q=x("a-space-compact"),A=x("a-popconfirm"),B=x("a-typography-link"),S=x("a-upload"),u=x("a-space");return D(),j(u,null,{default:d(()=>[f(q,{size:a.size},{default:d(()=>[a.refresh.isShow!==!1?(D(),j(P,{key:0,title:a.refresh.title},{default:d(()=>[f(v,{onClick:a.refresh.onClick},{default:d(()=>[f(O(Gt))]),_:1},8,["onClick"])]),_:1},8,["title"])):Z("",!0)]),_:1},8,["size"]),f(q,{size:a.size},{default:d(()=>[a.filter.isShow!==!1?(D(),j(P,{key:0,title:a.filter.title},{default:d(()=>[f(v,{onClick:a.filter.onClick,style:ge({color:a.filter.isActive?a.activateColor:null})},{default:d(()=>[f(O(it))]),_:1},8,["onClick","style"])]),_:1},8,["title"])):Z("",!0),a.export.isShow!==!1?(D(),j(P,{key:1,title:a.export.title},{default:d(()=>[f(A,{title:a.export.title,"ok-text":"所有","cancel-text":"本页","ok-button-props":r,"cancel-button-props":r,onConfirm:a.export.onExportAll,onCancel:a.export.onExportPage},{default:d(()=>[f(v,null,{default:d(()=>[f(O(Qt))]),_:1})]),_:1},8,["title","onConfirm","onCancel"])]),_:1},8,["title"])):Z("",!0),a.sort.isShow!==!1?(D(),j(P,{key:2,title:a.sort.title},{default:d(()=>[f(v,{onClick:a.sort.onClick,style:ge({color:a.sort.isActive?y.activateColor:null})},{default:d(()=>[f(O(He))]),_:1},8,["onClick","style"])]),_:1},8,["title"])):Z("",!0)]),_:1},8,["size"]),f(q,{size:a.size},{default:d(()=>[a.add.isShow!==!1?(D(),j(P,{key:0,title:a.add.title},{default:d(()=>[f(v,{onClick:a.add.onClick},{default:d(()=>[f(O(Zt))]),_:1},8,["onClick"])]),_:1},8,["title"])):Z("",!0),a.import.isShow!==!1?(D(),j(P,{key:1},{title:d(()=>[f(B,{onClick:a.import.downloadTemplate},{default:d(()=>[ne(ae(a.import.title),1)]),_:1},8,["onClick"])]),default:d(()=>[f(S,{"file-list":e.value,"before-upload":i,"show-upload-list":!1,accept:".xlsx"},{default:d(()=>[f(v,{onClick:a.import.onClick},{default:d(()=>[f(O(eo))]),_:1},8,["onClick"])]),_:1},8,["file-list"])]),_:1})):Z("",!0),a.edit.isShow!==!1?(D(),j(P,{key:2,title:a.edit.title},{default:d(()=>[f(v,{onClick:a.edit.onClick,disabled:a.edit.isDisabled},{default:d(()=>[f(O(to))]),_:1},8,["onClick","disabled"])]),_:1},8,["title"])):Z("",!0),a.remove.isShow!==!1?(D(),j(P,{key:3,title:a.remove.title},{default:d(()=>[f(A,{title:"确认删除","ok-text":"确认","ok-button-props":r,"show-cancel":!1,onConfirm:a.remove.onClick,disabled:a.remove.isDisabled},{default:d(()=>[f(v,{disabled:a.remove.isDisabled},{default:d(()=>[f(O(oo))]),_:1},8,["disabled"])]),_:1},8,["onConfirm","disabled"])]),_:1},8,["title"])):Z("",!0)]),_:1},8,["size"]),ye(y.$slots,"toolbar")]),_:3})}}}),Io=()=>({locale:{type:Object},size:{type:String,default:"small"},columns:{type:Object,required:!0},tableTitle:{type:String},theme:{type:String},url:{type:String,required:!0,default:""},pageSize:{type:Number,default:10},autoLoad:{type:Boolean,default:!0},autoSelect:{type:Boolean,default:!0},isDebug:{type:Boolean,default:!1},addTitle:{type:String,default:""},refreshTitle:{type:String,default:""},drawWidth:{type:[Number,String],default:720},drawSubmitTitle:{type:String,default:""},editTitle:{type:String,default:""},sortTitle:{type:String,default:""},filterTitle:{type:String,default:""},removeTitle:{type:String,default:""},importTitle:{type:String,default:""},exportTitle:{type:String,default:""},exportFileName:{type:Function},initFilterConditions:{type:Array,default:[]},frozenFilterConditions:{type:Array,default:[]},initSorterConditions:{type:Array,default:[]},language:{type:Object,default:()=>({toolbarRefresh:"刷新",toolbarFilter:"筛选",toolbarSort:"排序",toolbarEdit:"编辑",toolbarRemove:"删除",toolbarAdd:"新增",toolbarExport:"导出",toolbarImport:"导入",noChange:"没啥需要更新",refreshError:"刷新失败",exportError:"导出失败",addError:"新增失败",editError:"更新失败",removeError:"删除失败",importError:"导入失败",addSuccess:"新增成功",editSuccess:"修改成功",removeSuccess:"删除成功",importSuccess:"导入成功",loadError:"读取数据失败",importNoFileError:"没有文件",importFileError:"导入文件失败",templateError:"下载模板失败",selectRow:"请先选中一行",confirm:"确定",submit:"提交",reset:"重置",cancel:"取消",summaryTotal:"共"})},toolbar:{type:Object,default:()=>({hasRefresh:!0,hasFilter:!0,hasSort:!0,hasAdd:!0,hasEdit:!0,hasRemove:!0,hasExport:!1,hasImport:!1})},onBeforeRefresh:{type:Function},onPostRefresh:{type:Function},onPostLoadData:{type:Function},onBeforeFilter:{type:Function},onAfterFilter:{type:Function},onPreFilter:{type:Function},onPostFilter:{type:Function},onBeforeSort:{type:Function},onAfterSort:{type:Function},onPreSort:{type:Function},onPostSort:{type:Function},onBeforeEdit:{type:Function},onAfterEdit:{type:Function},onPreEdit:{type:Function},onPostEdit:{type:Function},onBeforeAdd:{type:Function},onAfterAdd:{type:Function},onPreAdd:{type:Function},onPostAdd:{type:Function},onPreAddOrEdit:{type:Function},onPostAddOrEdit:{type:Function},onPreRemove:{type:Function},onPostRemove:{type:Function},onBeforeExport:{type:Function},onAfterExport:{type:Function},onPreExport:{type:Function},onPostExport:{type:Function},onBeforeImportFile:{type:Function},onAfterImportFile:{type:Function},onPreImportFile:{type:Function},onPostImportFile:{type:Function},onPreImport:{type:Function},onPostImport:{type:Function},onPrePage:{type:Function},onPostPage:{type:Function},onAfterRowClick:{type:Function},onAfterRowDbClick:{type:Function}}),Fo=o=>{o.toolbar===void 0?o.toolbar={hasAdd:!0,hasEdit:!0,hasExport:!1,hasFilter:!0,hasImport:!1,hasRefresh:!0,hasRemove:!0,hasSort:!0}:o.toolbar===null?o.toolbar={hasAdd:!1,hasEdit:!1,hasExport:!1,hasFilter:!1,hasImport:!1,hasRefresh:!1,hasRemove:!1,hasSort:!1}:(o.toolbar.hasAdd==null&&(o.toolbar.hasAdd=!0),o.toolbar.hasEdit==null&&(o.toolbar.hasEdit=!0),o.toolbar.hasExport==null&&(o.toolbar.hasExport=!1),o.toolbar.hasFilter==null&&(o.toolbar.hasFilter=!0),o.toolbar.hasImport==null&&(o.toolbar.hasImport=!1),o.toolbar.hasRefresh==null&&(o.toolbar.hasRefresh=!0),o.toolbar.hasRemove==null&&(o.toolbar.hasRemove=!0),o.toolbar.hasSort==null&&(o.toolbar.hasSort=!0)),o.initFilterConditions||(o.initFilterConditions=[]),o.frozenFilterConditions||(o.frozenFilterConditions=[]),o.initSorterConditions||(o.initSorterConditions=[]);for(const c in o.columns)ct(o.columns[c],[c])},ct=(o,c)=>{if(o.hasOwnProperty("title")&&Fe(o.title)){Do(o,[...c]);return}if(Fe(o))throw new Error(`column配置错误:(${o})`);for(const r in o){const a=o[r];ct(a,[...c,r])}},Do=(o,c)=>{var a,e,i,y,p,v;const r=c.join(".");if(o.key=r,o._katableIsCol=!0,o.dbInfo?o.dbInfo.dataType==null?o.dbInfo.dataType="string":o.dbInfo.dataType==="date"&&o.dbInfo.dateFormat===void 0&&(o.dbInfo.dateFormat="YYYY/MM/DD"):o.dbInfo={dataType:"string"},o.listInfo){if(o.listInfo.index===void 0)throw`列(${o.key})未设置(listInfo.index)`;o.listInfo.title||(o.listInfo.title=o.title.toString()||ao(c)),o.listInfo.width===void 0&&(o.listInfo.width=100)}o.editorInfo&&(o.editorInfo.componentType==="select"&&(o.editorInfo.options||(o.editorInfo.options=(a=o.listInfo)==null?void 0:a.options)),o.editorInfo.isPost==null&&(o.editorInfo.isPost=!0)),o.filterInfo||(o.filterInfo={isFilter:((e=o.editorInfo)==null?void 0:e.isPost)!==!1}),o.filterInfo.width||(o.filterInfo.width=((i=o.editorInfo)==null?void 0:i.width)||((y=o.listInfo)==null?void 0:y.width)||100),o.exportInfo==null&&((p=o.listInfo)==null?void 0:p.index)!=null&&(o.exportInfo={index:o.listInfo.index}),o.exportInfo&&(o.title||(o.title=(v=o.listInfo)==null?void 0:v.title))},To=o=>{const c={},r=a=>{if(a._katableIsCol){const e=a;c[e.key]=e}else for(const e in a){const i=a[e];r(i)}};for(const a in o)r(o[a]);return c},Eo=o=>{const c={},r=a=>{var e,i,y;if(a._katableIsCol){let p=a;if(((e=p.editorInfo)==null?void 0:e.index)!=null){if(p.key==null)throw`${p.title}没有_key`;const v={key:p.key,index:p.editorInfo.index,title:Ee([p.editorInfo.title,p.title,p.key]),width:p.editorInfo.width||"100%",position:p.editorInfo.position||"line",isPost:p.editorInfo.isPost==null?!0:p.editorInfo.isPost,display:p.editorInfo.display||"show",rules:p.editorInfo.rules,componentType:"input",valueConverter:p.editorInfo.valueConverter,customComponent:p.editorInfo.customComponent,debounceDelay:p.editorInfo.debounceDelay,onAfterChange:p.editorInfo.onAfterChange};if(v.attrs={},p.editorInfo.componentType)v.componentType=p.editorInfo.componentType;else switch((i=p.dbInfo)==null?void 0:i.dataType){case"date":case"number":v.componentType=p.dbInfo.dataType;break;default:v.componentType="input";break}v.componentType==="date"?(v.attrs.format=((y=p.dbInfo)==null?void 0:y.dateFormat)||"YYYY-MM-DD",v.attrs.showNow=!0,v.attrs.showToday=!0,v.attrs.showTime=ut(v.attrs.format)):v.componentType==="number"?v.attrs.precision=p.editorInfo.precision:v.componentType==="select"&&(p.editorInfo.options||console.error(`${p.key}缺少editorInfo.options`),v.options=p.editorInfo.options,v.attrs.showSearch=!0,v.attrs.mode=p.editorInfo.selectMode||"combobox",v.attrs.mode!=="combobox"&&(v.selectSplit=p.editorInfo.selectSplit||";"),be(v.options)&&(v.attrs.options=v.options)),Object.assign(v.attrs,p.editorInfo.attrs),c[p.key]=v}}else for(const p in a){const v=a[p];r(v)}};for(const a in o)r(o[a]);return c},Ao=(o,c)=>{const r=[],a=e=>{var i,y,p,v,P,q,A,B;if(e._katableIsCol){let S=e,u=c[S.key];if((i=S.filterInfo)!=null&&i.isFilter){const b={key:S.key,title:Ee([(y=S.listInfo)==null?void 0:y.title,S.title,S.key]),componentType:"input",valueConverter:S.filterInfo.valueConverter,debounceDelay:u==null?void 0:u.debounceDelay,width:(p=S.filterInfo.width)==null?void 0:p.toString()};if(b.attrs={},u)b.componentType=u.componentType;else switch((v=S.dbInfo)==null?void 0:v.dataType){case"date":case"number":b.componentType=S.dbInfo.dataType;break;default:b.componentType="input";break}b.componentType==="date"?(b.attrs.format=((P=S.dbInfo)==null?void 0:P.dateFormat)||"YYYY-MM-DD",b.attrs.showNow=!0,b.attrs.showToday=!0,b.attrs.showTime=ut(b.attrs.format)):b.componentType==="number"?b.attrs.precision=(q=u==null?void 0:u.attrs)==null?void 0:q.precision:b.componentType==="select"&&(b.options=S.filterInfo.options||(u==null?void 0:u.options)||((A=S.listInfo)==null?void 0:A.options),b.attrs.showSearch=!0,b.attrs.mode=((B=u==null?void 0:u.attrs)==null?void 0:B.mode)||"combobox",be(b.options)?b.attrs.options=b.options:b.attrs.options=[]),Object.assign(b.attrs,S.filterInfo.attrs),r.push(b)}}else for(const S in e){const u=e[S];a(u)}};for(const e in o)a(o[e]);return r},Oo=o=>{const c=[],r=a=>{var e,i,y;if(a._katableIsCol){const p=a;((e=p.exportInfo)==null?void 0:e.index)!=null&&c.push({key:p.key,title:Ee([p.exportInfo.title,p.title,p.key]),formula:p.exportInfo.formula,dateFormat:((i=p.dbInfo)==null?void 0:i.dataType)==="date"?((y=p.dbInfo)==null?void 0:y.dateFormat)||"YYYY-MM-DD":void 0,index:p.exportInfo.index})}else for(const p in a){const v=a[p];r(v)}};for(const a in o)r(o[a]);return c.sort(Me("index")),c},Po=o=>{const c=[],r=a=>{var e,i;if(a._katableIsCol){const y=a;((e=y.importInfo)==null?void 0:e.index)!=null&&c.push({key:y.key,dataIndex:y.key,title:Ee([y.importInfo.title,y.title,y.key]),index:y.importInfo.index,width:(i=y.listInfo)==null?void 0:i.width})}else for(const y in a){const p=a[y];r(p)}};for(const a in o)r(o[a]);return c.sort(Me("index")),c},Ro=o=>{const c={},r=a=>{var e,i;if(a._katableIsCol){let y=a;y.sortInfo&&(c[y.key]=((i=(e=y.listInfo)==null?void 0:e.title)==null?void 0:i.toString())||y.title||y.key)}else for(const y in a){const p=a[y];r(p)}};for(const a in o)r(o[a]);return c},rt=o=>{o.sort(Me("index"));let c=1;for(const r of o)r.index!=null&&(r.index=c,c++)},st=(o,c)=>{for(const r of o)No(r,c.find(a=>a.key===r.key))},No=(o,c)=>{c?c.index!==null?(o.sortOrder=c.order,o.sorter={multiple:c.index}):(o.sortOrder=null,o.sorter={multiple:0}):(o.sortOrder=null,o.sorter=!1)},jo=o=>{const c=[],r=a=>{var e;if(a._katableIsCol){let i=a;if(i.listInfo){const y={dataIndex:i.key.split("."),key:i.key,title:Ee([i.listInfo.title,i.title,i.key]),width:i.listInfo.width||"100",customCell:i.listInfo.customCell,customHeaderCell:i.listInfo.customHeaderCell,customRender:i.listInfo.customRender,align:i.listInfo.align||(((e=i.dbInfo)==null?void 0:e.dataType)==="number"?"right":"left"),ellipsis:i.listInfo.ellipsis||!0,index:i.listInfo.index,options:i.listInfo.options};Object.assign(y,i.listInfo.attrs),c.push(y)}}else for(const i in a){const y=a[i];r(y)}};for(const a in o)r(o[a]);return c.sort(Me("index")),c},Vo=(o,c)=>{for(const r of c){const a=o.find(e=>e.key===r.key);a&&(a.filteredValue=[],a.customFilterDropdown=!0)}},Ee=o=>o.find(c=>c!=null),ut=o=>{const c=[],r=o.match(/h+/i);r&&(c.push(r.index),c.push(r.index+r[0].length));const a=o.match(/m+/);a&&(c.push(a.index),c.push(a.index+a[0].length));const e=o.match(/s+/);return e&&(c.push(e.index),c.push(e.index+e[0].length)),c.length===0?!1:{format:o.substring(Math.min(...c),Math.max(...c)+1)}},Me=o=>(c,r)=>(c[o]==null)-(r[o]==null)||+(c[o]>r[o])||-(c[o]<r[o]),ue=o=>{const c=new URLSearchParams;for(const r in o)o[r]!==null&&c.append(r,o[r]);return c},$o=me({__name:"KaDragList",setup(o,{expose:c}){const r=N([]),a=N(-1),e=N(-1),i=N(-1),y=(S,u)=>{e.value=u},p=(S,u)=>{S.preventDefault(),a.value=u},v=(S,u)=>{S.preventDefault(),i.value=u;let b=e.value,G=u;b!==G&&r.value.splice(G,0,r.value.splice(b,1)[0]),a.value=-1},P=S=>{const u=S.target.closest(".ant-list-item");u==null||u.setAttribute("draggable","true")},q=S=>{const u=S.target.closest(".ant-list-item");u==null||u.setAttribute("draggable","false")};return c({setSorter:S=>{r.value=S},getSorter:()=>r.value}),(S,u)=>{const b=x("a-flex"),G=x("a-list-item"),g=x("a-list");return D(),j(g,{size:"small",bordered:"","data-source":r.value},{renderItem:d(({item:k,index:z})=>[f(G,{class:Le({"drag-over-top":z===a.value&&z<e.value,"drag-over-bottom":z===a.value&&z>e.value,disabled:k.disabled}),onDragstart:U=>y(U,z),onDragover:U=>p(U,z),onDrop:U=>v(U,z)},{actions:d(()=>[ye(S.$slots,"renderAction",{item:k},void 0,!0)]),default:d(()=>[f(b,{gap:"small",style:{width:"100%"}},{default:d(()=>[De("div",{class:Le([{hide:k.disabled},"move-icon"]),onMouseenter:P,onMouseleave:q},[f(O(no))],34),ye(S.$slots,"renderItem",{item:k},()=>[ne(ae(k.title),1)],!0)]),_:2},1024)]),_:2},1032,["class","onDragstart","onDragover","onDrop"])]),_:3},8,["data-source"])}}}),zo=ze($o,[["__scopeId","data-v-b7f872b8"]]),Mo=me({__name:"KaSorter",props:{primaryColor:{type:String},colObj:{type:Object,required:!0}},setup(o,{expose:c}){const r=o,a=N();return c({setSorter:e=>{var i;(i=a.value)==null||i.setSorter(e.map(y=>({...y,disabled:y.order===null})))},getSorter:()=>{var i;let e=0;return(i=a.value)==null?void 0:i.getSorter().map(y=>({key:y.key,index:y.order===null?null:++e,order:y.order}))}}),(e,i)=>{const y=x("a-radio-button"),p=x("a-radio-group");return D(),j(zo,{ref_key:"$list",ref:a},{renderItem:d(({item:v})=>[De("span",{style:ge([{color:r.primaryColor},{width:"1rem"}])},[fe(f(O(He),null,null,512),[[pe,v.order==="ascend"]]),fe(f(O(ot),null,null,512),[[pe,v.order==="descend"]])],4),ne(" "+ae(r.colObj[v.key]),1)]),renderAction:d(({item:v})=>[f(p,{value:v.order,"onUpdate:value":P=>v.order=P,onChange:P=>v.disabled=v.order===null,"button-style":"solid"},{default:d(()=>[f(y,{value:"ascend"},{default:d(()=>[f(O(He))]),_:1}),f(y,{value:"descend"},{default:d(()=>[f(O(ot))]),_:1}),f(y,{value:null},{default:d(()=>[f(O(lo))]),_:1})]),_:2},1032,["value","onUpdate:value","onChange"])]),_:1},512)}}}),Bo={style:{padding:"8px"}},Yo=me({__name:"KaTable",props:Io(),setup(o,{expose:c}){co(t=>({"5aaaeead":O(q),"617ff6de":O(v),"0d21752e":O(P),ee33a702:S,"228dc415":O(A),"47fa6e20":B})),he.prototype.toJSON=function(){return this.format()};let r=ro.create();const a=uo();(a==null?void 0:a.proxy).$axios&&(r=(a==null?void 0:a.proxy).$axios);const e=o,{useToken:i}=go,{token:y}=i(),p=e.theme||y.value.colorPrimary,v=e.theme?e.theme+"55":y.value.colorPrimaryBg,P=e.theme?e.theme+"33":y.value.colorFillAlter,q=e.theme||y.value.colorFillAlter,A=e.theme||y.value.colorBorderSecondary,B=y.value.borderRadiusLG+"px",S=y.value.paddingXS+"px",u=Ye({list:!1,draw:!1}),b=N();let G={};const g=Ye({records:[],activeIndex:null,summary:null,get curRecord(){return this.activeIndex!=null?this.records[this.activeIndex]:null}}),k=Ye({current:1,pageSize:e.pageSize,total:0,showSizeChanger:!1,showTotal:(t,n)=>`${n[0]}-${n[1]} / ${t}`}),z=N([]),U=N(""),ee=N(!1),l=N(e.drawWidth||720),_=N(null),C=N(),V=N({});let K=[];const I=N(!1),$=N(),R=N([]),le=N(!1);let se=[];const M=N(),W=N({});let T={};const H=N();let te=[],ie=[];const Y=N([]);so(b,t=>{switch(t){case"Add":U.value=e.addTitle||e.language.toolbarAdd,_e(),_.value=Et,ee.value=!0;break;case"Edit":U.value=e.editTitle||e.language.toolbarEdit,_e(),_.value=At,ee.value=!0;break;case"Sort":U.value=e.sortTitle||e.language.toolbarSort,_e(),_.value=gt,ee.value=!0;break;case"Filter":U.value=e.filterTitle||e.language.toolbarFilter,_e(),_.value=St,ee.value=!0;break;case"Import":U.value=e.importTitle||e.language.toolbarImport,_e(),_.value=zt,ee.value=!0;break;default:ee.value=!1;break}}),c({reRenderEditor:()=>{var t;(t=M.value)==null||t.reRender()},getEditorVal:t=>{var n;return(n=M.value)==null?void 0:n.getEditorVal(t)},setEditorVal:(t,n,s,m)=>{var h;return(h=M.value)==null?void 0:h.setEditorVal(t,n,s,m)},resetFields:t=>{var n;return(n=M.value)==null?void 0:n.resetFields(t)},clearValidate:t=>{var n;return(n=M.value)==null?void 0:n.clearValidate(t)},validate:(t,n)=>{var s;return(s=M.value)==null?void 0:s.validate(t,n)},validateFields:(t,n)=>{var s;return(s=M.value)==null?void 0:s.validateFields(t,n)},scrollToField:(t,n)=>{var s;return(s=M.value)==null?void 0:s.scrollToField(t,n)},getEditorObj:()=>Rt(),getAntCols:()=>yt(),reloadData:async()=>await re(),reinit:()=>{var t;We(),(t=$.value)==null||t.render(R.value)},setFilters:t=>{Oe(t,!1)},setSorters:t=>{Ae(t)},getData:()=>g});const dt=(t,n)=>({onclick:async s=>{g.activeIndex=n,await F(e.onAfterRowClick)},onDblclick:async s=>{g.activeIndex=n,await F(e.onAfterRowDbClick)}}),ft=(t,n)=>n===g.activeIndex?"ka-table-selected-row":"",_e=()=>{let t=0;if(po(e.drawWidth))t=e.drawWidth;else if(Fe(e.drawWidth))parseInt(e.drawWidth)===+e.drawWidth&&(t=parseInt(e.drawWidth));else return l.value=e.drawWidth;return window.innerWidth<t?l.value="100%":l.value=t},pt=(t,n,s)=>{var w,E;if(t==null)return"";if(n.options){if(be(n.options))return((w=n.options.find(L=>L.value===t))==null?void 0:w.label)||t;if(Ve(n.options))return((E=n.options(t).find(L=>L.value===t))==null?void 0:E.label)||t}const m=je(e.columns,n.key);if(m.dbInfo.dataType==="date")return he(t).format(m.dbInfo.dateFormat);const h=W.value[n.key];return h&&h.selectSplit?t.join(h.selectSplit):t},yt=()=>z.value,mt=async(t,n,s,m)=>{e.isDebug&&console.groupCollapsed("onTableChange");try{if(k.current=t.current,m.action==="sort"){const h=ht(s,K);Ae(h)}if(m.action==="filter"){const h=kt(n);Oe(h,!0)}if(m.action==="paginate"&&!await F(e.onPrePage)||(await re(),m.action==="paginate"&&!await F(e.onPostPage)))return}catch(h){J(h)}e.isDebug&&console.groupEnd()},vt=async()=>{e.isDebug&&console.groupCollapsed("onToolbarRefresh"),u.list=!0;try{if(!await F(e.onBeforeRefresh)||(await re(),!await F(e.onPostRefresh)))return}catch(t){J(t)}finally{b.value="List",u.list=!1,e.isDebug&&console.groupEnd()}},re=async()=>{var t,n;e.isDebug&&console.groupCollapsed("loadData");try{u.list=!0;const s=K.filter(w=>w.index!=null).sort((w,E)=>w.index-E.index);e.isDebug&&console.log("sortConditions->",JSON.stringify(s)),e.isDebug&&console.log("whereConditions->",JSON.stringify(se));const h=(await r.post(e.url,ue({actNo:"search",searchPar:JSON.stringify({sortConditions:s,whereConditions:[...se,...e.frozenFilterConditions],pageSize:k.pageSize,pageNum:k.current})}))).data;if(h.isSuccess){if(h.total>0&&h.records.length===0){let w=k.pageSize?Math.ceil(h.total/k.pageSize):1;if((k.current||1)>w){k.current=w,re();return}}for(const w in G){const E=G[w];if(((t=E.dbInfo)==null?void 0:t.dataType)==="date")for(const L of h.records)at(L,E.key,Q=>Q&&he(Q));else if(((n=E.editorInfo)==null?void 0:n.selectMode)==="multiple"){const L=W.value[E.key];if(L)for(const Q of h.records)at(Q,E.key,ke=>ke&&ke.split(L.selectSplit))}}}else throw new Error(h.message||e.language.loadError);g.records=h.records||[],g.summary=h.summary||[],k.total=h.total||0,g.activeIndex=null,await F(e.onPostLoadData)}catch(s){throw g.records=[],k.total=0,g.activeIndex=null,s}finally{u.list=!1,e.isDebug&&console.groupEnd()}},ht=(t,n)=>{if(console.log("convertAntSortToSorterConditions"),n==null)return[];let s=n.reduce((h,w)=>w.index>h?w.index:h,0),m=t.length?t:[t];for(const h of n){const w=m.find(E=>E.columnKey===h.key);w==null||w.order==null?(h.index=null,h.order=null):(h.order=w.order,h.index==null&&(h.index=++s))}return rt(n),n},bt=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarSort"),u.list=!0,u.draw=!0;try{if(!await F(e.onBeforeSort)||((t=C.value)==null||t.setSorter(K),b.value="Sort",!await F(e.onAfterSort)))return}catch(n){J(n)}finally{u.list=!1,u.draw=!1,e.isDebug&&console.groupEnd()}},gt=async()=>{var t;e.isDebug&&console.log("sortSubmit"),u.draw=!0;try{if(!await F(e.onPreSort))return;const n=(t=C.value)==null?void 0:t.getSorter();if(Ae(n),await re(),!await F(e.onPostSort))return;b.value="List"}catch(n){J(n)}finally{u.draw=!1}},Ae=t=>{const n=[];for(const s in V.value){const m=t.find(h=>h.key===s);m?n.push({key:s,index:m.index,order:m.order}):n.push({key:s,order:null,index:null})}rt(n),e.toolbar.hasSort?st(z.value,n):st(z.value,[]),K=n,I.value=t.some(s=>s.order)},_t=(t,n,s,m)=>{m.filteredValue=n,s()},wt=(t,n,s)=>{t(),s.filteredValue=[],n()},kt=t=>{const n=[];for(const s in t){const m=t[s];if(m&&m.length){const h=R.value.find(E=>E.key===s);let w="eq";(h==null?void 0:h.componentType)==="input"&&(w="like"),n.push({key:s,opt:w,bool:"and",val:m.length===1?m[0]:m})}}return n},Ct=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarFilter"),u.list=!0,u.draw=!0;try{if(!await F(e.onBeforeFilter)||((t=$.value)==null||t.setConditions(se),b.value="Filter",!await F(e.onAfterFilter)))return}catch(n){J(n)}finally{u.draw=!1,u.list=!1,e.isDebug&&console.groupEnd()}},St=async()=>{var t;e.isDebug&&console.log("filterSubmit"),u.draw=!0;try{if(!await F(e.onPreFilter)||(Oe(((t=$.value)==null?void 0:t.getConditions())||[],!1),await re(),!await F(e.onPostFilter)))return;b.value="List"}catch(n){J(n)}finally{u.draw=!1}},xt=async(t,n)=>{const s=R.value.find(m=>m.key===t);s&&s.options&&Ve(s.options)&&(s.attrs.options=await s.options(n))},It=()=>{for(const t of z.value)t.customFilterDropdown&&(t.filteredValue=[])},Oe=(t,n=!0)=>{var s;!n&&It(),(s=$.value)==null||s.setConditions(t),le.value=!!t.length,se=t},Ft=()=>{var n;const t=g.curRecord;for(const s in W.value){const m=qe(je(t,s));(n=M.value)==null||n.setEditorVal(s,m,!1,!0)}},Dt=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarEdit"),u.list=!0,u.draw=!0;try{if(g.activeIndex==null)throw e.language.selectRow;if(!await F(e.onBeforeEdit)||(Ft(),b.value="Edit",!await F(e.onAfterEdit)))return}catch(n){J(n)}finally{(t=M.value)==null||t.clearValidate(),u.list=!1,u.draw=!1,e.isDebug&&console.groupEnd()}},Tt=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarAdd"),u.list=!0,u.draw=!0;try{if(!await F(e.onBeforeAdd)||((t=M.value)==null||t.clearEditor(),b.value="Add",!await F(e.onAfterAdd)))return}catch(n){J(n)}finally{u.list=!1,u.draw=!1,e.isDebug&&console.groupEnd()}},Et=async()=>{var t,n;e.isDebug&&console.groupCollapsed("addSubmit"),u.draw=!0;try{if(await((t=M.value)==null?void 0:t.validate().catch(m=>{if(m.errorFields&&m.errorFields.length)throw m.errorFields[0].errors[0]})),T=(n=M.value)==null?void 0:n.getEditorVal(),!await F(e.onPreAddOrEdit)||!await F(e.onPreAdd))return;const s=await Ot();if(!await F(e.onPostAddOrEdit,s)||!await F(e.onPostAdd,s))return;we(e.language.addSuccess),b.value="List",await re()}catch(s){J(s)}finally{u.draw=!1,e.isDebug&&console.groupEnd()}},At=async()=>{var t,n;e.isDebug&&console.groupCollapsed("editSubmit"),u.draw=!0;try{if(await((t=M.value)==null?void 0:t.validate().catch(m=>{if(m.errorFields&&m.errorFields.length)throw m.errorFields[0].errors[0]})),T=(n=M.value)==null?void 0:n.getEditorVal(),!await F(e.onPreAddOrEdit)||!await F(e.onPreEdit))return;const s=await Pt();if(!await F(e.onPostAddOrEdit,s)||!await F(e.onPostEdit,s))return;we(e.language.editSuccess),b.value="List",await re()}catch(s){J(s)}finally{u.draw=!1,e.isDebug&&console.groupEnd()}},Ot=async()=>{e.isDebug&&console.log("insertData");const t=JSON.stringify(Be(!1,!0,!0));if(t==="{}")throw e.language.noChange;const n=await r.post(e.url,ue({actNo:"insert",record:t}));if(!n.data.isSuccess)throw n.data.message||e.language.addError;return n.data.record},Pt=async()=>{e.isDebug&&console.log("updateData");const t=JSON.stringify(Be(!0,!0,!0));if(t==="{}")throw e.language.noChange;const n=await r.post(e.url,ue({actNo:"update",newRecord:t,oldRecord:JSON.stringify(Xe())}));if(!n.data.isSuccess)throw n.data.message||e.language.editError;return n.data.record},Rt=()=>W.value,Nt=async()=>{e.isDebug&&console.groupCollapsed("onToolbarRemove"),u.list=!0;try{if(g.activeIndex==null)throw e.language.selectRow;if(!await F(e.onPreRemove)||(b.value="Remove",await jt(),!await F(e.onPostRemove)))return;we(e.language.removeSuccess),b.value="List",await re()}catch(t){J(t)}finally{u.list=!1,e.isDebug&&console.groupEnd()}},jt=async()=>{e.isDebug&&console.log("removeData");const t=await r.post(e.url,ue({actNo:"remove",record:JSON.stringify(Xe())}));if(!t.data.isSuccess)throw t.data.message||e.language.removeError},Ke=async t=>{e.isDebug&&console.groupCollapsed("onToolbarExport"),u.list=!0;try{if(!await F(e.onBeforeExport)||(await Vt(t),!await F(e.onAfterExport)))return}catch(n){J(n)}finally{u.list=!1,e.isDebug&&console.groupEnd()}},Vt=async t=>{var w;await F(e.onPreExport);const n=K.filter(E=>E.order!=null),s=`${e.tableTitle}(${he().format("YYYYMMDDHHmmss")})`,m=await r.post(e.url,ue({actNo:"export",exportPar:JSON.stringify({sortConditions:n,whereConditions:[...se,...e.frozenFilterConditions],pageNum:k.current,pageSize:t?0:k.pageSize,cols:te,fileName:s})}),{responseType:"blob"});if((w=m.headers["content-type"])!=null&&w.toString().includes("application/json"))throw JSON.parse(await m.data.text()).Message||e.language.exportError;const h=new Blob([m.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});H.value.href=URL.createObjectURL(h),H.value.download=e.exportFileName?e.exportFileName():s,H.value.click(),await F(e.onPostExport)},$t=async t=>{e.isDebug&&console.groupCollapsed("uploadFile"),u.list=!0;try{if(t==null)return;const n=new FormData;n.append("file",t),n.append("cols",JSON.stringify(ie.map(h=>({key:h.key,title:h.title})))),n.append("actNo","import_file");const m=(await r.post(e.url,n)).data;if(m.isSuccess)Y.value=m.records,b.value="Import";else throw new Error(m.message||e.language.importFileError)}catch(n){J(n)}finally{u.list=!1,e.isDebug&&console.groupEnd()}},zt=async()=>{e.isDebug&&console.groupCollapsed("importSubmit"),u.draw=!0;try{if(!await F(e.onPreImport,Y.value)||(await Mt(),!await F(e.onPostImport,Y.value)))return;we(e.language.importSuccess),b.value="List",await re()}catch(t){J(t)}finally{u.draw=!1,e.isDebug&&console.groupEnd()}},Mt=async()=>{e.isDebug&&console.log("importData");const t=await r.post(e.url,ue({actNo:"import",records:JSON.stringify(Y.value)}));if(!t.data.isSuccess)throw t.data.message||e.language.importError},Bt=async()=>{var s;const t=await r.post(e.url,ue({actNo:"download_template",cols:JSON.stringify(ie.map(m=>({key:m.key,title:m.title})))}),{responseType:"blob"});if((s=t.headers["content-type"])!=null&&s.toString().includes("application/json"))throw JSON.parse(await t.data.text()).Message||e.language.templateError;const n=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});H.value.href=URL.createObjectURL(n),H.value.download="template.xlsx",H.value.click()},We=()=>{e.isDebug&&console.log("init"),Fo(e);const t=Eo(e.columns),n=Ao(e.columns,t),s=Ro(e.columns),m=jo(e.columns);te=Oo(e.columns),ie=Po(e.columns),G=To(e.columns),e.toolbar.hasFilter&&Vo(m,n),W.value=t,R.value=n,V.value=s,z.value=m,Ae(e.initSorterConditions),Oe(e.initFilterConditions),ie.length||(e.toolbar.hasImport=!1)},F=async(t,n)=>{if(t){const s=await t(n||{...g,editorRecord:Be()});if(!s.isSuccess)return J(s.message||e.language.refreshError),!1;if(s.message){let m=!0;if(s.alertType==="alert"?await new Promise((h,w)=>{we(s.message,h)}):m=await new Promise((h,w)=>{Yt(h,s.message)}),!m)return!1}}return!0},Be=(t=!1,n=!1,s=!1)=>{const m={},h=g.curRecord;try{for(const w in T){let E=T[w],L=t?je(h,w):E+"x";const Q=W.value[w];n&&Q.componentType==="select"&&Q.selectSplit&&(E!=null&&(E=E.length?E.join(Q.selectSplit):null),t&&L!=null&&(L=L.length?L.join(Q.selectSplit):null)),E+""!=L+""&&(s&&Q.isPost||!s)&&nt(m,w,E)}}catch(w){throw console.error(w),w}return m},Xe=()=>{var t;try{const n=g.curRecord,s=qe(n);for(const m in G){const h=G[m],w=W.value[m];if(((t=h.editorInfo)==null?void 0:t.isPost)!==!1){let E=je(n,m);(w==null?void 0:w.componentType)==="select"&&(w!=null&&w.selectSplit)&&E!=null&&(E=E.length?E.join(w.selectSplit):null),nt(s,m,E)}}return s}catch(n){throw console.error(n),n}},Yt=(t,n)=>{Ue.confirm({title:n,onOk(){t(!0)},onCancel(){t(!1)}})},J=t=>{Ue.error({title:Fe(t)?t:t.message})},we=(t,n)=>{Ue.info({title:Fe(t)?t:t.message,onOk(){n&&n(!0)}})},Ut=()=>{b.value=null};return Je(()=>{We()}),io(async()=>{if(e.autoLoad)try{await re()}catch(t){J(t)}}),(t,n)=>{const s=x("a-typography-title"),m=x("a-flex"),h=x("a-button"),w=x("a-space"),E=x("a-typography-text"),L=x("a-table"),Q=x("a-spin"),ke=x("a-drawer"),Lt=x("a-config-provider");return D(),j(Lt,{"component-size":e.size,locale:e.locale,theme:e.theme?{token:{colorPrimary:e.theme,colorBorderSecondary:e.theme,colorFillAlter:O(P),colorFillSecondary:O(P),colorBgContainerDisabled:"#F0F0F0"}}:{}},{default:d(()=>[f(L,{class:"ka-table",bordered:"","custom-row":dt,"row-class-name":ft,pagination:k.pageSize===0?!1:k,onChange:mt,loading:u.list,"data-source":g.records,showSorterTooltip:!1,columns:z.value,scroll:{x:"max-content"}},fo({summary:d(()=>[ye(t.$slots,"summaryBar",{summary:g.summary},void 0,!0)]),bodyCell:d(({text:X,column:ce,index:Pe,record:Re})=>[ye(t.$slots,"bodyItem",{column:ce,index:Pe,text:X,record:Re},()=>[ne(ae(pt(X,ce,Re)),1)],!0)]),title:d(()=>[f(m,{class:"ka-table-title",justify:"space-between",align:"center"},{default:d(()=>[f(s,{level:4,style:{margin:"0"}},{default:d(()=>[ne(ae(e.tableTitle),1)]),_:1}),De("div",null,[f(xo,{refresh:{isShow:e.toolbar.hasRefresh,title:e.refreshTitle||e.language.toolbarRefresh,onClick:vt},filter:{isShow:e.toolbar.hasFilter,title:e.filterTitle||e.language.toolbarFilter,isActive:le.value,onClick:Ct},export:{isShow:e.toolbar.hasExport,title:e.exportTitle||e.language.toolbarExport,onExportAll(X){Ke(!0)},onExportPage(X){Ke(!1)}},sort:{isActive:I.value,isShow:e.toolbar.hasSort,title:e.sortTitle||e.language.toolbarSort,onClick:bt},add:{isShow:e.toolbar.hasAdd,title:e.addTitle||e.language.toolbarAdd,onClick:Tt},import:{isShow:e.toolbar.hasImport,title:e.importTitle||e.language.toolbarImport,beforeUpload:$t,downloadTemplate:Bt},edit:{isDisabled:g.activeIndex==null,isShow:e.toolbar.hasEdit,title:e.editTitle||e.language.toolbarEdit,onClick:Dt},remove:{isShow:e.toolbar.hasRemove,title:e.removeTitle||e.language.toolbarRemove,isDisabled:g.activeIndex==null,onClick:Nt},"activate-color":O(p)},{toolbar:d(()=>[ye(t.$slots,"toolbar",{dataSource:g},void 0,!0)]),_:3},8,["refresh","filter","export","sort","add","import","edit","remove","activate-color"])])]),_:3})]),customFilterDropdown:d(({setSelectedKeys:X,selectedKeys:ce,confirm:Pe,clearFilters:Re,column:ve})=>[De("div",Bo,[f(w,{direction:"vertical",style:{width:"100%"}},{default:d(()=>{var Ge,Qe,Ze;return[f($e,Te({value:ce[0],onChange:oe=>{X(oe?[oe]:[])},onSearch:oe=>xt(ve.key,oe),"component-type":(Ge=R.value.find(oe=>oe.key===ve.key))==null?void 0:Ge.componentType},(Qe=R.value.find(oe=>oe.key===ve.key))==null?void 0:Qe.attrs,{style:{width:(Ze=R.value.find(oe=>oe.key===ve.key))==null?void 0:Ze.width}}),null,16,["value","onChange","onSearch","component-type","style"]),f(m,{justify:"space-between",align:"center"},{default:d(()=>[f(h,{onClick:oe=>_t(X,ce,Pe,ve),type:"primary"},{default:d(()=>[ne(ae(e.language.toolbarFilter),1)]),_:2},1032,["onClick"]),f(h,{onClick:oe=>wt(Re,Pe,ve)},{default:d(()=>[ne(ae(e.language.reset),1)]),_:2},1032,["onClick"])]),_:2},1024)]}),_:2},1024)])]),customFilterIcon:d(({filtered:X})=>[f(O(it),{style:ge({color:X?e.theme:void 0})},null,8,["style"])]),headerCell:d(({column:X})=>[f(m,{justify:"space-between",align:"center"},{default:d(()=>[De("span",null,ae(X.title),1),fe(f(E,{type:"secondary"},{default:d(()=>[ne(ae(X.sorter.multiple),1)]),_:2},1536),[[pe,X.sortOrder]])]),_:2},1024)]),_:2},[Ie(t.$slots,(X,ce)=>({name:ce,fn:d(()=>[ye(t.$slots,ce,{},void 0,!0)])}))]),1032,["pagination","loading","data-source","columns"]),f(ke,{title:U.value,open:ee.value,width:l.value,onClose:Ut,class:"ka-table-drawer",closable:!u.draw,"mask-closable":!1,"force-render":!0,"header-style":{"padding-top":"8px","padding-bottom":"8px"},"body-style":{"padding-top":"8px","padding-bottom":"8px"}},{extra:d(()=>[f(w,null,{default:d(()=>[f(h,{type:"primary",onClick:_.value,loading:u.draw,size:"normal"},{default:d(()=>[ne(ae(e.drawSubmitTitle||e.language.confirm),1)]),_:1},8,["onClick","loading"])]),_:1})]),default:d(()=>[f(Q,{spinning:u.draw},{default:d(()=>[e.toolbar.hasSort?fe((D(),j(Mo,{key:0,ref_key:"$sorter",ref:C,"col-obj":V.value},null,8,["col-obj"])),[[pe,b.value==="Sort"]]):Z("",!0),e.toolbar.hasFilter?fe((D(),j(Co,{key:1,columns:R.value,ref_key:"$filter",ref:$},null,8,["columns"])),[[pe,b.value==="Filter"]]):Z("",!0),e.toolbar.hasAdd||e.toolbar.hasEdit?fe((D(),j(wo,{key:2,ref_key:"$form",ref:M,"items-obj":W.value},null,8,["items-obj"])),[[pe,["Add","Edit"].includes(b.value)]]):Z("",!0),e.toolbar.hasImport?fe((D(),j(L,{key:3,bordered:"",columns:O(ie),dataSource:Y.value,pagination:!1},{footer:d(()=>[ne(ae(e.language.summaryTotal)+": "+ae(Y.value.length),1)]),_:1},8,["columns","dataSource"])),[[pe,b.value==="Import"]]):Z("",!0)]),_:1},8,["spinning"])]),_:1},8,["title","open","width","closable"]),e.toolbar.hasExport?(D(),de("a",{key:0,ref_key:"$export",ref:H,style:{display:"none"}},null,512)):Z("",!0)]),_:3},8,["component-size","locale","theme"])}}}),Ho=ze(Yo,[["__scopeId","data-v-c2897db1"]]);export{Ho as K};
