import{d as me,cc as tt,cd as Xt,ce as xe,cf as ot,j as F,o as E,c as j,w as d,cg as Gt,m as Te,r as P,n as Ke,ch as fe,ci as Fe,F as Ie,cj as _e,ck as Qt,cl as qe,f,cm as $e,cn as He,co as Zt,l as ee,u as O,cp as Ne,bN as eo,cq as to,cr as he,bR as be,cs as oo,ct as te,bO as ut,cu as ao,cv as Je,cw as lo,t as Z,cx as no,cy as ro,cz as so,cA as pe,cB as De,cC as io,e as Ee,cD as co,k as se,v as ie,cE as at,cF as uo,cG as fo,h as Ue,z as lt,cH as nt,cI as Ve,cJ as rt,s as po,cK as mo,A as yo,cL as vo,cM as go}from"./vendor.js";import{I as bo,T as ho,a as _o,D as wo,S as ko,b as Le,t as Co}from"./ant-design-vue.js";import{_ as Me}from"./Home.js";const st=o=>{const u=[],r=[];Object.keys(o).forEach(i=>{r.push(o[i])}),r.sort((i,m)=>i.index-m.index);let e=null;for(let i of r)i.position==="line"||i.position==null||e===null?(e=[[i]],u.push(e)):i.position==="inline"?e.push([i]):i.position==="cling"&&e[e.length-1].push(i);return u},ze=me({__name:"KaInput",props:tt({valueConverter:{type:Function},componentType:{type:String,default:"input"},customComponent:{type:Object},debounceDelay:{type:Number,default:300}},{modelValue:{},modelModifiers:{}}),emits:tt(["change","search"],["update:modelValue"]),setup(o,{emit:u}){const r=Xt(o,"modelValue"),a=u,e=o,i={input:xe(bo),textarea:xe(ho),number:xe(_o),date:xe(wo),select:xe(ko)},m=ot(A=>{console.log("onSearchDebounce"),A&&a("search",A)},e.debounceDelay),p=ot(async(A,M)=>{await v(A,M)},e.debounceDelay),v=async(A,M)=>{e.valueConverter&&(A=await e.valueConverter(A)),a("change",A,M)},R=async(A,M)=>{if(A instanceof Event&&(A=A.target.value),e.debounceDelay===0||["date","select"].includes(e.componentType)){await v(A,M);return}p(A,M)},J=A=>{m(A)};return(A,M)=>{const S=F("a-config-provider");return E(),j(S,{theme:{token:{colorTextDisabled:"#00000088"}}},{default:d(()=>[(E(),j(Gt(e.customComponent||i[o.componentType]),Te({value:r.value,"onUpdate:value":M[0]||(M[0]=c=>r.value=c)},A.$attrs,{onChange:R,onSearch:J,"show-search":"","allow-clear":"",class:"ka-input"}),null,16,["value"]))]),_:1})}}}),So=me({__name:"KaEditor",props:{itemsObj:{type:Object,required:!0}},setup(o,{expose:u}){const r=o,a=P(null),e=P([]),i=P({}),m=()=>{e.value=st(r.itemsObj)},p=async(h,C,$)=>{C.onAfterChange&&await C.onAfterChange(h,$)},v=async(h,C)=>{$e(C.options)&&C.attrs&&(C.attrs.options=await C.options(h))};return u({reRender:m,getEditorVal:h=>h?i.value[h]:i.value,setEditorVal:async(h,C,$=!0,Y=!1)=>{if(h){i.value[h]=C,Y&&await v(C,r.itemsObj[h]),$&&await p(C,r.itemsObj[h]);try{await a.value.validateFields(h)}catch{}}},clearEditor:()=>{for(const h in i.value)i.value[h]=null;a.value.resetFields()},resetFields:h=>a.value.resetFields(h),clearValidate:h=>a.value.clearValidate(h),validate:(h,C)=>a.value.validate(h,C),validateFields:(h,C)=>a.value.validateFields(h,C),scrollToField:(h,C)=>a.value.scrollToField(h,C)}),Ke(()=>{e.value=st(r.itemsObj)}),(h,C)=>{const $=F("a-form-item-rest"),Y=F("a-input-group"),oe=F("a-form-item"),n=F("a-form");return E(),j(n,{ref_key:"$form",ref:a,model:i.value,layout:"vertical"},{default:d(()=>[(E(!0),fe(Ie,null,Fe(e.value,(w,_)=>(E(),fe("div",{class:"editor-row",key:_,style:_e({display:Qt(w,2).some(N=>N.display!=="hide")?"flex":"none"})},[(E(!0),fe(Ie,null,Fe(w,(N,G)=>(E(),j(oe,{key:G,label:N[0].title,rules:N[0].rules,name:N[0].key,class:qe([{hide:N[0].display==="hide"},"item-flex"])},{default:d(()=>[f(Y,{compact:N.length>1},{default:d(()=>[(E(!0),fe(Ie,null,Fe(N,(x,B)=>(E(),fe(Ie,{key:B},[B===0?(E(),j(ze,Te({key:0,style:{width:x.width,display:x.display==="hide"?"none":"auto"},modelValue:i.value[x.key],"onUpdate:modelValue":V=>i.value[x.key]=V,ref_for:!0},x.attrs,{"component-type":x.componentType,"value-converter":x.valueConverter,"custom-component":x.customComponent,"debounce-delay":x.debounceDelay,disabled:x.display==="readonly",onChange:(V,L)=>{p(V,x,L)},onSearch:V=>{v(V,x)},size:"normal"}),null,16,["style","modelValue","onUpdate:modelValue","component-type","value-converter","custom-component","debounce-delay","disabled","onChange","onSearch"])):(E(),j($,{key:1},{default:d(()=>[f(ze,Te({style:{width:x.width,display:x.display==="hide"?"none":"auto"},modelValue:i.value[x.key],"onUpdate:modelValue":V=>i.value[x.key]=V,ref_for:!0},x.attrs,{"component-type":x.componentType,"value-converter":x.valueConverter,"custom-component":x.customComponent,"debounce-delay":x.debounceDelay,disabled:x.display==="readonly",onChange:(V,L)=>{p(V,x,L)},onSearch:V=>{v(V,x)},size:"normal"}),null,16,["style","modelValue","onUpdate:modelValue","component-type","value-converter","custom-component","debounce-delay","disabled","onChange","onSearch"])]),_:2},1024))],64))),128))]),_:2},1032,["compact"])]),_:2},1032,["label","rules","name","class"]))),128))],4))),128))]),_:1},8,["model"])}}}),xo=Me(So,[["__scopeId","data-v-ef9ade20"]]),ge=()=>({key:"",val:"",bool:"and"}),Io=me({__name:"KaFilter",props:{columns:{type:Array,required:!0},items:{type:Array,default:[ge()]}},setup(o,{expose:u}){const r=o,a=P(r.items);let e=[];const i=[{label:"等于",value:"eq"},{label:"不等于",value:"neq"},{label:"大于",value:"gt"},{label:"大于等于",value:"gte"},{label:"小于",value:"lt"},{label:"小于等于",value:"lte"},{label:"开头于",value:"beg"},{label:"结束于",value:"end"},{label:"包含",value:"like"},{label:"空",value:"nu"},{label:"不为空",value:"nnu"}],m=(n,w)=>{n.col=r.columns.find(_=>_.key===n.key),n.opt=void 0,n.optOptions=J(n),n.val="",n.valOptions=void 0,n.valComponent=void 0,n.valAttrs=void 0},p=(n,w)=>{var G,x,B,V,L,ue,re,z,I;if(!w)return;let _=he(n.val)?n.val[0]:n.val,N=he(n.val)?n.val:n.val==null||n.val==""?[]:[n.val];if(_ instanceof be&&(_=_.format(((x=(G=n.col)==null?void 0:G.attrs)==null?void 0:x.format)||"YYYY-MM-DD"),N[0]=_),["beg","end"].includes(w)){n.valComponent="input",n.val=_,n.valOptions=void 0,n.valAttrs=void 0;return}if(["nu","nnu"].includes(w)){n.valComponent="input",n.val="",n.valOptions=void 0,n.valAttrs=void 0;return}if(["eq","neq","gt","gte","lt","lte","like"].includes(w)&&n.col.options){n.valComponent="select",n.valOptions=he((B=n.col)==null?void 0:B.options)?(V=n.col)==null?void 0:V.options:void 0,n.valAttrs=((L=n.col)==null?void 0:L.attrs)||{},n.val=((ue=n.valAttrs)==null?void 0:ue.mode)==="combobox"?_:N,R(n,_);return}n.col.componentType==="textarea"?n.valComponent="input":n.valComponent=n.col.componentType,n.valComponent==="number"?n.val=parseFloat(_)||null:n.valComponent==="date"?n.val=_?be(_,((z=(re=n.col)==null?void 0:re.attrs)==null?void 0:z.format)||"YYYY-MM-DD"):null:n.val=_,n.valAttrs=(I=n.col)==null?void 0:I.attrs,n.valOptions=void 0},v=(n,w)=>{var _;(_=n.col)!=null&&_.valueConverter&&(n.val=w)},R=async(n,w)=>{var _;$e((_=n.col)==null?void 0:_.options)&&(n.valOptions=await n.col.options(w))},J=n=>{var w,_,N,G,x;return((w=n.col)==null?void 0:w.componentType)==="number"?i.filter(B=>["eq","neq","gt","gte","lt","lte","in","nu","nnu"].includes(B.value)):((_=n.col)==null?void 0:_.componentType)==="date"?i.filter(B=>["eq","neq","gt","gte","lt","lte","nu","nnu"].includes(B.value)):((N=n.col)==null?void 0:N.componentType)==="select"&&((x=(G=n.col)==null?void 0:G.attrs)==null?void 0:x.mode)==="multiple"?i.filter(B=>["eq","neq","like","nu","nnu"].includes(B.value)):i},A=()=>({key:"",val:"",bool:"and",children:[ge()]}),M=n=>{a.value.splice(n,0,ge())},S=n=>{a.value.splice(n+1,0,ge())},c=n=>{a.value.splice(n,0,A())},b=n=>{a.value.splice(n+1,0,A())},X=n=>{a.value.splice(n,1),a.value.length===0&&a.value.push(ge())},h=n=>{if(n.length===0){a.value=[ge()];return}n[0].bool="and";const w=[];for(const _ of n)w.push(C(_));a.value=w},C=n=>{const w={...n};if(n.children){w.children=[];for(const _ of n.children)w.children.push(C(_))}else w.col=r.columns.find(_=>_.key===w.key),w.optOptions=J(w),p(w,w.opt);return w},$=()=>Y(a.value),Y=n=>{const w=[];for(const _ of n){if(!_.children&&!_.key)continue;const N=He(Zt(_,["key","opt","val","bool"]));_.children&&(N.children=Y(_.children)),w.push(N)}return w},oe=n=>{n?e=n.map(w=>({label:w.title,value:w.key})):e=r.columns.map(w=>({label:w.title,value:w.key}))};return u({setConditions:h,getConditions:$,render:oe}),Ke(()=>{oe()}),(n,w)=>{const _=F("a-select-option"),N=F("a-select"),G=F("ka-filter",!0),x=F("a-space-compact"),B=F("a-menu-item"),V=F("a-menu-divider"),L=F("a-menu"),ue=F("a-button"),re=F("a-dropdown"),z=F("a-flex");return E(),j(z,{vertical:"vertical",gap:"small"},{default:d(()=>[(E(!0),fe(Ie,null,Fe(a.value,(I,ae)=>(E(),j(z,{gap:"small",class:"katable-filter",key:ae},{default:d(()=>[f(N,{class:"bool",value:I.bool,"onUpdate:value":q=>I.bool=q,"show-arrow":!1,"popup-class-name":"katable-filter-bool-popup",style:_e({visibility:ae===0?"hidden":void 0}),size:"nomal"},{default:d(()=>[f(_,{value:"and"},{default:d(()=>[ee("且")]),_:1}),f(_,{value:"or"},{default:d(()=>[ee("或")]),_:1})]),_:2},1032,["value","onUpdate:value","style"]),I.children?(E(),j(G,{key:0,class:"child",items:I.children,columns:r.columns},null,8,["items","columns"])):(E(),j(x,{key:1,class:"flex-auto-width"},{default:d(()=>{var q,we;return[f(N,{class:"col",value:I.key,"onUpdate:value":U=>I.key=U,"show-arrow":!1,options:O(e),onChange:U=>{m(I,U)},size:"nomal"},null,8,["value","onUpdate:value","options","onChange"]),f(N,{class:"opt","show-arrow":!1,value:I.opt,"onUpdate:value":U=>I.opt=U,options:I.optOptions,onChange:U=>{p(I,U)},disabled:!I.key,size:"nomal"},null,8,["value","onUpdate:value","options","onChange","disabled"]),f(ze,Te({modelValue:I.val,"onUpdate:modelValue":U=>I.val=U,"component-type":I.valComponent,ref_for:!0},I.valAttrs,{"value-converter":(q=I.col)==null?void 0:q.valueConverter,"debounce-delay":(we=I.col)==null?void 0:we.debounceDelay,disabled:!I.opt||I.opt==="nu"||I.opt==="nnu",onChange:U=>{v(I,U)},onSearch:U=>{R(I,U)},options:I.valOptions,class:"flex-auto-width",style:{flex:"1"}}),null,16,["modelValue","onUpdate:modelValue","component-type","value-converter","debounce-delay","disabled","onChange","onSearch","options"])]}),_:2},1024)),f(re,{size:"nomal"},{overlay:d(()=>[f(L,null,{default:d(()=>[f(B,{key:"1",onClick:q=>S(ae)},{default:d(()=>[f(O(Ne))]),_:2},1032,["onClick"]),f(B,{key:"2",onClick:q=>M(ae),class:"katable-filter-action-rvs"},{default:d(()=>[f(O(Ne))]),_:2},1032,["onClick"]),f(V),f(B,{key:"3",onClick:q=>b(ae)},{default:d(()=>[f(O(Ne),{class:"katable-filter-action-grp"})]),_:2},1032,["onClick"]),f(B,{key:"4",onClick:q=>c(ae),class:"katable-filter-action-rvs"},{default:d(()=>[f(O(Ne),{class:"katable-filter-action-grp"})]),_:2},1032,["onClick"]),f(V),f(B,{key:"5",onClick:q=>X(ae)},{default:d(()=>[f(O(eo))]),_:2},1032,["onClick"])]),_:2},1024)]),default:d(()=>[f(ue,{size:"nomal"},{default:d(()=>[f(O(to))]),_:1})]),_:2},1024)]),_:2},1024))),128))]),_:1})}}}),Fo=Me(Io,[["__scopeId","data-v-89866051"]]),Do=()=>({size:{type:String,default:"small"},refresh:{type:Object,default:()=>({isShow:!0,title:"刷新",isActive:!1,isDisabled:!1})},filter:{type:Object,default:()=>({isShow:!0,title:"筛选",isActive:!1,isDisabled:!1})},sort:{type:Object,default:()=>({isShow:!0,title:"排序",isActive:!1,isDisabled:!1})},add:{type:Object,default:()=>({isShow:!0,title:"新增",isActive:!1,isDisabled:!1})},edit:{type:Object,default:()=>({isShow:!0,title:"编辑",isActive:!1,isDisabled:!1})},remove:{type:Object,default:()=>({isShow:!0,title:"删除",isActive:!1,isDisabled:!1})},export:{type:Object,default:()=>({isShow:!0,title:"导出",isActive:!1,isDisabled:!1})},import:{type:Object,default:()=>({isShow:!0,title:"导入",isActive:!1,isDisabled:!1})},activateColor:{type:String,default:"#1677ff"}}),Eo=me({__name:"KaToolbar",props:Do(),setup(o,{expose:u}){const r={style:{borderRadius:"6px"}},a=o,e=P([]),i=m=>(e.value=[m],a.import.beforeUpload&&a.import.beforeUpload(m),!1);return u({getFileList:()=>e.value}),(m,p)=>{const v=F("a-button"),R=F("a-tooltip"),J=F("a-space-compact"),A=F("a-popconfirm"),M=F("a-typography-link"),S=F("a-upload"),c=F("a-space");return E(),j(c,null,{default:d(()=>[f(J,{size:a.size},{default:d(()=>[a.refresh.isShow!==!1?(E(),j(R,{key:0,title:a.refresh.title},{default:d(()=>[f(v,{onClick:a.refresh.onClick},{default:d(()=>[f(O(oo))]),_:1},8,["onClick"])]),_:1},8,["title"])):te("",!0)]),_:1},8,["size"]),f(J,{size:a.size},{default:d(()=>[a.filter.isShow!==!1?(E(),j(R,{key:0,title:a.filter.title},{default:d(()=>[f(v,{onClick:a.filter.onClick,style:_e({color:a.filter.isActive?a.activateColor:null})},{default:d(()=>[f(O(ut))]),_:1},8,["onClick","style"])]),_:1},8,["title"])):te("",!0),a.export.isShow!==!1?(E(),j(R,{key:1,title:a.export.title},{default:d(()=>[f(A,{title:a.export.title,"ok-text":"所有","cancel-text":"本页","ok-button-props":r,"cancel-button-props":r,onConfirm:a.export.onExportAll,onCancel:a.export.onExportPage},{default:d(()=>[f(v,null,{default:d(()=>[f(O(ao))]),_:1})]),_:1},8,["title","onConfirm","onCancel"])]),_:1},8,["title"])):te("",!0),a.sort.isShow!==!1?(E(),j(R,{key:2,title:a.sort.title},{default:d(()=>[f(v,{onClick:a.sort.onClick,style:_e({color:a.sort.isActive?m.activateColor:null})},{default:d(()=>[f(O(Je))]),_:1},8,["onClick","style"])]),_:1},8,["title"])):te("",!0)]),_:1},8,["size"]),f(J,{size:a.size},{default:d(()=>[a.add.isShow!==!1?(E(),j(R,{key:0,title:a.add.title},{default:d(()=>[f(v,{onClick:a.add.onClick},{default:d(()=>[f(O(lo))]),_:1},8,["onClick"])]),_:1},8,["title"])):te("",!0),a.import.isShow!==!1?(E(),j(R,{key:1},{title:d(()=>[f(M,{onClick:a.import.downloadTemplate},{default:d(()=>[ee(Z(a.import.title),1)]),_:1},8,["onClick"])]),default:d(()=>[f(S,{"file-list":e.value,"before-upload":i,"show-upload-list":!1,accept:".xlsx"},{default:d(()=>[f(v,{onClick:a.import.onClick},{default:d(()=>[f(O(no))]),_:1},8,["onClick"])]),_:1},8,["file-list"])]),_:1})):te("",!0),a.edit.isShow!==!1?(E(),j(R,{key:2,title:a.edit.title},{default:d(()=>[f(v,{onClick:a.edit.onClick,disabled:a.edit.isDisabled},{default:d(()=>[f(O(ro))]),_:1},8,["onClick","disabled"])]),_:1},8,["title"])):te("",!0),a.remove.isShow!==!1?(E(),j(R,{key:3,title:a.remove.title},{default:d(()=>[f(A,{title:"确认删除","ok-text":"确认","ok-button-props":r,"show-cancel":!1,onConfirm:a.remove.onClick,disabled:a.remove.isDisabled},{default:d(()=>[f(v,{disabled:a.remove.isDisabled},{default:d(()=>[f(O(so))]),_:1},8,["disabled"])]),_:1},8,["onConfirm","disabled"])]),_:1},8,["title"])):te("",!0)]),_:1},8,["size"]),pe(m.$slots,"toolbar")]),_:3})}}}),To=()=>({locale:{type:Object},size:{type:String,default:"small"},scroll:{type:Object},columns:{type:Object,required:!0},tableTitle:{type:String},theme:{type:String},url:{type:String,required:!0,default:""},pageSize:{type:Number,default:10},autoLoad:{type:Boolean,default:!0},autoSelect:{type:Boolean,default:!0},isDebug:{type:Boolean,default:!1},addTitle:{type:String,default:""},refreshTitle:{type:String,default:""},drawWidth:{type:[Number,String],default:720},drawSubmitTitle:{type:String,default:""},drawClearTitle:{type:String,default:""},editTitle:{type:String,default:""},sortTitle:{type:String,default:""},filterTitle:{type:String,default:""},removeTitle:{type:String,default:""},importTitle:{type:String,default:""},exportTitle:{type:String,default:""},exportFileName:{type:Function},initFilterConditions:{type:Array,default:[]},frozenFilterConditions:{type:Array,default:[]},initSorterConditions:{type:Array,default:[]},language:{type:Object,default:{}},defaultLang:{type:String,default:"cn"},toolbar:{type:Object,default:()=>({hasRefresh:!0,hasFilter:!0,hasSort:!0,hasAdd:!0,hasEdit:!0,hasRemove:!0,hasExport:!1,hasImport:!1})},onBeforeRefresh:{type:Function},onPostRefresh:{type:Function},onPostLoadData:{type:Function},onBeforeFilter:{type:Function},onAfterFilter:{type:Function},onPreFilter:{type:Function},onPostFilter:{type:Function},onBeforeSort:{type:Function},onAfterSort:{type:Function},onPreSort:{type:Function},onPostSort:{type:Function},onBeforeEdit:{type:Function},onAfterEdit:{type:Function},onPreEdit:{type:Function},onPostEdit:{type:Function},onBeforeAdd:{type:Function},onAfterAdd:{type:Function},onPreAdd:{type:Function},onPostAdd:{type:Function},onPreAddOrEdit:{type:Function},onPostAddOrEdit:{type:Function},onPreRemove:{type:Function},onPostRemove:{type:Function},onBeforeExport:{type:Function},onAfterExport:{type:Function},onPreExport:{type:Function},onPostExport:{type:Function},onBeforeImportFile:{type:Function},onAfterImportFile:{type:Function},onPreImportFile:{type:Function},onPostImportFile:{type:Function},onPreImport:{type:Function},onPostImport:{type:Function},onPrePage:{type:Function},onPostPage:{type:Function},onAfterRowClick:{type:Function},onAfterRowDbClick:{type:Function}}),dt={toolbarRefresh:"刷新",toolbarFilter:"筛选",toolbarSort:"排序",toolbarEdit:"编辑",toolbarRemove:"删除",toolbarAdd:"新增",toolbarExport:"导出",toolbarImport:"导入",noChange:"没啥需要更新",refreshError:"刷新失败",exportError:"导出失败",addError:"新增失败",editError:"更新失败",removeError:"删除失败",importError:"导入失败",addSuccess:"新增成功",editSuccess:"修改成功",removeSuccess:"删除成功",importSuccess:"导入成功",loadError:"读取数据失败",importNoFileError:"没有文件",importFileError:"导入文件失败",templateError:"下载模板失败",selectRow:"请先选中一行",confirm:"确定",clear:"清空",submit:"提交",reset:"重置",cancel:"取消",summaryTotal:"共"},ft={toolbarRefresh:"refresh",toolbarFilter:"filter",toolbarSort:"sort",toolbarEdit:"edit",toolbarRemove:"remove",toolbarAdd:"add",toolbarExport:"export",toolbarImport:"import",noChange:"no change",refreshError:"refresh fail",exportError:"export fail",addError:"add fail",editError:"update fail",removeError:"remove fail",importError:"import fail",addSuccess:"add success",editSuccess:"update success",removeSuccess:"remove success",importSuccess:"import success",loadError:"load data fail",importNoFileError:"no file",importFileError:"import file fail",templateError:"download template fail",selectRow:"please select a row first",confirm:"confirm",clear:"clear",submit:"submit",reset:"reset",cancel:"cancel",summaryTotal:"total"},Ao=o=>{var u;(u=o.language)!=null&&u.addError||(o.defaultLang==="en"?Object.assign(o.language,ft):Object.assign(o.language,dt)),o.toolbar===void 0?o.toolbar={hasAdd:!0,hasEdit:!0,hasExport:!1,hasFilter:!0,hasImport:!1,hasRefresh:!0,hasRemove:!0,hasSort:!0}:o.toolbar===null?o.toolbar={hasAdd:!1,hasEdit:!1,hasExport:!1,hasFilter:!1,hasImport:!1,hasRefresh:!1,hasRemove:!1,hasSort:!1}:(o.toolbar.hasAdd==null&&(o.toolbar.hasAdd=!0),o.toolbar.hasEdit==null&&(o.toolbar.hasEdit=!0),o.toolbar.hasExport==null&&(o.toolbar.hasExport=!1),o.toolbar.hasFilter==null&&(o.toolbar.hasFilter=!0),o.toolbar.hasImport==null&&(o.toolbar.hasImport=!1),o.toolbar.hasRefresh==null&&(o.toolbar.hasRefresh=!0),o.toolbar.hasRemove==null&&(o.toolbar.hasRemove=!0),o.toolbar.hasSort==null&&(o.toolbar.hasSort=!0)),o.initFilterConditions||(o.initFilterConditions=[]),o.frozenFilterConditions||(o.frozenFilterConditions=[]),o.initSorterConditions||(o.initSorterConditions=[]);for(const r in o.columns)pt(o.columns[r],[r])},pt=(o,u)=>{if(o.hasOwnProperty("title")&&De(o.title)){Oo(o,[...u]);return}if(De(o))throw new Error(`column配置错误:(${o})`);for(const r in o){const a=o[r];pt(a,[...u,r])}},Oo=(o,u)=>{var a,e,i,m,p,v;const r=u.join(".");if(o.key=r,o._katableIsCol=!0,o.dbInfo?o.dbInfo.dataType==null?o.dbInfo.dataType="string":o.dbInfo.dataType==="date"&&o.dbInfo.dateFormat===void 0&&(o.dbInfo.dateFormat="YYYY/MM/DD"):o.dbInfo={dataType:"string"},o.listInfo){if(o.listInfo.index===void 0)throw`列(${o.key})未设置(listInfo.index)`;o.listInfo.title||(o.listInfo.title=o.title.toString()||io(u)),o.listInfo.width===void 0&&(o.listInfo.width=100)}o.editorInfo&&(o.editorInfo.componentType==="select"&&(o.editorInfo.options||(o.editorInfo.options=(a=o.listInfo)==null?void 0:a.options)),o.editorInfo.isPost==null&&(o.editorInfo.isPost=!0)),o.filterInfo||(o.filterInfo={isFilter:((e=o.editorInfo)==null?void 0:e.isPost)!==!1}),o.filterInfo.width||(o.filterInfo.width=((i=o.editorInfo)==null?void 0:i.width)||((m=o.listInfo)==null?void 0:m.width)||100),o.exportInfo==null&&((p=o.listInfo)==null?void 0:p.index)!=null&&(o.exportInfo={index:o.listInfo.index}),o.exportInfo&&(o.title||(o.title=(v=o.listInfo)==null?void 0:v.title))},Po=o=>{const u={},r=a=>{if(a._katableIsCol){const e=a;u[e.key]=e}else for(const e in a){const i=a[e];r(i)}};for(const a in o)r(o[a]);return u},Ro=o=>{const u={},r=a=>{var e,i,m;if(a._katableIsCol){let p=a;if(((e=p.editorInfo)==null?void 0:e.index)!=null){if(p.key==null)throw`${p.title}没有_key`;const v={key:p.key,index:p.editorInfo.index,title:Ae([p.editorInfo.title,p.title,p.key]),width:p.editorInfo.width||"100%",position:p.editorInfo.position||"line",isPost:p.editorInfo.isPost==null?!0:p.editorInfo.isPost,display:p.editorInfo.display||"show",rules:p.editorInfo.rules,componentType:"input",valueConverter:p.editorInfo.valueConverter,customComponent:p.editorInfo.customComponent,debounceDelay:p.editorInfo.debounceDelay,onAfterChange:p.editorInfo.onAfterChange};if(v.attrs={},p.editorInfo.componentType)v.componentType=p.editorInfo.componentType;else switch((i=p.dbInfo)==null?void 0:i.dataType){case"date":case"number":v.componentType=p.dbInfo.dataType;break;default:v.componentType="input";break}v.componentType==="date"?(v.attrs.format=((m=p.dbInfo)==null?void 0:m.dateFormat)||"YYYY-MM-DD",v.attrs.showNow=!0,v.attrs.showToday=!0,v.attrs.showTime=mt(v.attrs.format)):v.componentType==="number"?v.attrs.precision=p.editorInfo.precision:v.componentType==="select"&&(p.editorInfo.options||console.error(`${p.key}缺少editorInfo.options`),v.options=p.editorInfo.options,v.attrs.showSearch=!0,v.attrs.mode=p.editorInfo.selectMode||"combobox",v.attrs.mode!=="combobox"&&(v.selectSplit=p.editorInfo.selectSplit||";"),he(v.options)&&(v.attrs.options=v.options)),Object.assign(v.attrs,p.editorInfo.attrs),u[p.key]=v}}else for(const p in a){const v=a[p];r(v)}};for(const a in o)r(o[a]);return u},jo=(o,u)=>{const r=[],a=e=>{var i,m,p,v,R,J,A,M;if(e._katableIsCol){let S=e,c=u[S.key];if((i=S.filterInfo)!=null&&i.isFilter){const b={key:S.key,title:Ae([(m=S.listInfo)==null?void 0:m.title,S.title,S.key]),componentType:"input",valueConverter:S.filterInfo.valueConverter,debounceDelay:c==null?void 0:c.debounceDelay,width:(p=S.filterInfo.width)==null?void 0:p.toString()};if(b.attrs={},c)b.componentType=c.componentType;else switch((v=S.dbInfo)==null?void 0:v.dataType){case"date":case"number":b.componentType=S.dbInfo.dataType;break;default:b.componentType="input";break}b.componentType==="date"?(b.attrs.format=((R=S.dbInfo)==null?void 0:R.dateFormat)||"YYYY-MM-DD",b.attrs.showNow=!0,b.attrs.showToday=!0,b.attrs.showTime=mt(b.attrs.format)):b.componentType==="number"?b.attrs.precision=(J=c==null?void 0:c.attrs)==null?void 0:J.precision:b.componentType==="select"&&(b.options=S.filterInfo.options||(c==null?void 0:c.options)||((A=S.listInfo)==null?void 0:A.options),b.attrs.showSearch=!0,b.attrs.mode=((M=c==null?void 0:c.attrs)==null?void 0:M.mode)||"combobox",he(b.options)?b.attrs.options=b.options:b.attrs.options=[]),Object.assign(b.attrs,S.filterInfo.attrs),r.push(b)}}else for(const S in e){const c=e[S];a(c)}};for(const e in o)a(o[e]);return r},No=o=>{const u=[],r=a=>{var e,i,m;if(a._katableIsCol){const p=a;((e=p.exportInfo)==null?void 0:e.index)!=null&&u.push({key:p.key,title:Ae([p.exportInfo.title,p.title,p.key]),formula:p.exportInfo.formula,dateFormat:((i=p.dbInfo)==null?void 0:i.dataType)==="date"?((m=p.dbInfo)==null?void 0:m.dateFormat)||"YYYY-MM-DD":void 0,index:p.exportInfo.index})}else for(const p in a){const v=a[p];r(v)}};for(const a in o)r(o[a]);return u.sort(Be("index")),u},Vo=o=>{const u=[],r=a=>{var e,i;if(a._katableIsCol){const m=a;((e=m.importInfo)==null?void 0:e.index)!=null&&u.push({key:m.key,dataIndex:m.key,title:Ae([m.importInfo.title,m.title,m.key]),index:m.importInfo.index,width:(i=m.listInfo)==null?void 0:i.width})}else for(const m in a){const p=a[m];r(p)}};for(const a in o)r(o[a]);return u.sort(Be("index")),u},$o=o=>{const u={},r=a=>{var e,i;if(a._katableIsCol){let m=a;m.sortInfo&&(u[m.key]=((i=(e=m.listInfo)==null?void 0:e.title)==null?void 0:i.toString())||m.title||m.key)}else for(const m in a){const p=a[m];r(p)}};for(const a in o)r(o[a]);return u},it=o=>{o.sort(Be("index"));let u=1;for(const r of o)r.index!=null&&(r.index=u,u++)},ct=(o,u)=>{for(const r of o)zo(r,u.find(a=>a.key===r.key))},zo=(o,u)=>{u?u.index!==null?(o.sortOrder=u.order,o.sorter={multiple:u.index}):(o.sortOrder=null,o.sorter={multiple:0}):(o.sortOrder=null,o.sorter=!1)},Mo=o=>{const u=[],r=a=>{var e;if(a._katableIsCol){let i=a;if(i.listInfo){const m={dataIndex:i.key.split("."),key:i.key,title:Ae([i.listInfo.title,i.title,i.key]),width:i.listInfo.width||"100",customCell:i.listInfo.customCell,customHeaderCell:i.listInfo.customHeaderCell,customRender:i.listInfo.customRender,align:i.listInfo.align||(((e=i.dbInfo)==null?void 0:e.dataType)==="number"?"right":"left"),ellipsis:i.listInfo.ellipsis||!0,index:i.listInfo.index,options:i.listInfo.options};Object.assign(m,i.listInfo.attrs),u.push(m)}}else for(const i in a){const m=a[i];r(m)}};for(const a in o)r(o[a]);return u.sort(Be("index")),u},Bo=(o,u)=>{for(const r of u){const a=o.find(e=>e.key===r.key);a&&(a.filteredValue=[],a.customFilterDropdown=!0)}},Ae=o=>o.find(u=>u!=null),mt=o=>{const u=[],r=o.match(/h+/i);r&&(u.push(r.index),u.push(r.index+r[0].length));const a=o.match(/m+/);a&&(u.push(a.index),u.push(a.index+a[0].length));const e=o.match(/s+/);return e&&(u.push(e.index),u.push(e.index+e[0].length)),u.length===0?!1:{format:o.substring(Math.min(...u),Math.max(...u)+1)}},Be=o=>(u,r)=>(u[o]==null)-(r[o]==null)||+(u[o]>r[o])||-(u[o]<r[o]),de=o=>{const u=new URLSearchParams;for(const r in o)o[r]!==null&&u.append(r,o[r]);return u},Yo=me({__name:"KaDragList",setup(o,{expose:u}){const r=P([]),a=P(-1),e=P(-1),i=P(-1),m=(S,c)=>{e.value=c},p=(S,c)=>{S.preventDefault(),a.value=c},v=(S,c)=>{S.preventDefault(),i.value=c;let b=e.value,X=c;b!==X&&r.value.splice(X,0,r.value.splice(b,1)[0]),a.value=-1},R=S=>{const c=S.target.closest(".ant-list-item");c==null||c.setAttribute("draggable","true")},J=S=>{const c=S.target.closest(".ant-list-item");c==null||c.setAttribute("draggable","false")};return u({setSorter:S=>{r.value=S},getSorter:()=>r.value}),(S,c)=>{const b=F("a-flex"),X=F("a-list-item"),h=F("a-list");return E(),j(h,{size:"small",bordered:"","data-source":r.value},{renderItem:d(({item:C,index:$})=>[f(X,{class:qe({"drag-over-top":$===a.value&&$<e.value,"drag-over-bottom":$===a.value&&$>e.value,disabled:C.disabled}),onDragstart:Y=>m(Y,$),onDragover:Y=>p(Y,$),onDrop:Y=>v(Y,$)},{actions:d(()=>[pe(S.$slots,"renderAction",{item:C},void 0,!0)]),default:d(()=>[f(b,{gap:"small",style:{width:"100%"}},{default:d(()=>[Ee("div",{class:qe([{hide:C.disabled},"move-icon"]),onMouseenter:R,onMouseleave:J},[f(O(co))],34),pe(S.$slots,"renderItem",{item:C},()=>[ee(Z(C.title),1)],!0)]),_:2},1024)]),_:2},1032,["class","onDragstart","onDragover","onDrop"])]),_:3},8,["data-source"])}}}),Uo=Me(Yo,[["__scopeId","data-v-b7f872b8"]]),Lo=me({__name:"KaSorter",props:{primaryColor:{type:String},colObj:{type:Object,required:!0}},setup(o,{expose:u}){const r=o,a=P();return u({setSorter:e=>{var i;(i=a.value)==null||i.setSorter(e.map(m=>({...m,disabled:m.order===null})))},getSorter:()=>{var i;let e=0;return(i=a.value)==null?void 0:i.getSorter().map(m=>({key:m.key,index:m.order===null?null:++e,order:m.order}))}}),(e,i)=>{const m=F("a-radio-button"),p=F("a-radio-group");return E(),j(Uo,{ref_key:"$list",ref:a},{renderItem:d(({item:v})=>[Ee("span",{style:_e([{color:r.primaryColor},{width:"1rem"}])},[se(f(O(Je),null,null,512),[[ie,v.order==="ascend"]]),se(f(O(at),null,null,512),[[ie,v.order==="descend"]])],4),ee(" "+Z(r.colObj[v.key]),1)]),renderAction:d(({item:v})=>[f(p,{value:v.order,"onUpdate:value":R=>v.order=R,onChange:R=>v.disabled=v.order===null,"button-style":"solid"},{default:d(()=>[f(m,{value:"ascend"},{default:d(()=>[f(O(Je))]),_:1}),f(m,{value:"descend"},{default:d(()=>[f(O(at))]),_:1}),f(m,{value:null},{default:d(()=>[f(O(uo))]),_:1})]),_:2},1032,["value","onUpdate:value","onChange"])]),_:1},512)}}}),qo={style:{padding:"8px"}},Ho=me({__name:"KaTable",props:To(),setup(o,{expose:u}){mo(t=>({"2500c7fc":O(J),"62a3ff66":O(v),"91f16d8e":O(R),"32cc008a":S,"2b627d40":O(A),"78591a35":M})),be.prototype.toJSON=function(){return this.format()};let r=fo.create();const a=yo();(a==null?void 0:a.proxy).$axios&&(r=(a==null?void 0:a.proxy).$axios);const e=o,{useToken:i}=Co,{token:m}=i(),p=e.theme||m.value.colorPrimary,v=e.theme?e.theme+"55":m.value.colorPrimaryBg,R=e.theme?e.theme+"33":m.value.colorFillAlter,J=e.theme||m.value.colorFillAlter,A=e.theme||m.value.colorBorderSecondary,M=m.value.borderRadiusLG+"px",S=m.value.paddingXS+"px",c=Ue({list:!1,draw:!1}),b=P();let X={};const h=Ue({records:[],activeIndex:null,summary:null,get curRecord(){return this.activeIndex!=null?this.records[this.activeIndex]:null}}),C=Ue({current:1,pageSize:e.pageSize,total:0,showSizeChanger:!1,showTotal:(t,l)=>`${l[0]}-${l[1]} / ${t}`}),$=P([]),Y=P(""),oe=P(!1),n=P(e.drawWidth||720),w=P(null),_=P(null),N=P(),G=P({});let x=[];const B=P(!1),V=P(),L=P([]),ue=P(!1);let re=[];const z=P(),I=P({});let ae={};const q=P();let we=[],U=[];const ye=P([]);lt(()=>e.defaultLang,t=>{t==="en"?Object.assign(e.language,ft):t==="cn"&&Object.assign(e.language,dt)}),lt(b,t=>{switch(t){case"Add":Y.value=e.addTitle||e.language.toolbarAdd,ke(),w.value=jt,_.value=null,oe.value=!0;break;case"Edit":Y.value=e.editTitle||e.language.toolbarEdit,ke(),w.value=Nt,_.value=null,oe.value=!0;break;case"Sort":Y.value=e.sortTitle||e.language.toolbarSort,ke(),w.value=Ct,_.value=null,oe.value=!0;break;case"Filter":Y.value=e.filterTitle||e.language.toolbarFilter,ke(),w.value=Dt,_.value=Et,oe.value=!0;break;case"Import":Y.value=e.importTitle||e.language.toolbarImport,ke(),w.value=Lt,_.value=null,oe.value=!0;break;default:oe.value=!1,w.value=null,_.value=null;break}}),u({reRenderEditor:()=>{var t;(t=z.value)==null||t.reRender()},getEditorVal:t=>{var l;return(l=z.value)==null?void 0:l.getEditorVal(t)},setEditorVal:(t,l,s,y)=>{var g;return(g=z.value)==null?void 0:g.setEditorVal(t,l,s,y)},resetFields:t=>{var l;return(l=z.value)==null?void 0:l.resetFields(t)},clearValidate:t=>{var l;return(l=z.value)==null?void 0:l.clearValidate(t)},validate:(t,l)=>{var s;return(s=z.value)==null?void 0:s.validate(t,l)},validateFields:(t,l)=>{var s;return(s=z.value)==null?void 0:s.validateFields(t,l)},scrollToField:(t,l)=>{var s;return(s=z.value)==null?void 0:s.scrollToField(t,l)},getEditorObj:()=>zt(),getAntCols:()=>bt(),reloadData:async()=>await ne(),reinit:()=>{var t;Xe(),(t=V.value)==null||t.render(L.value)},setFilters:t=>{Pe(t,!1)},setSorters:t=>{Oe(t)},getData:()=>h});const yt=(t,l)=>({onclick:async s=>{h.activeIndex=l,await D(e.onAfterRowClick)},onDblclick:async s=>{h.activeIndex=l,await D(e.onAfterRowDbClick)}}),vt=(t,l)=>l===h.activeIndex?"ka-table-selected-row":"",ke=()=>{let t=0;if(go(e.drawWidth))t=e.drawWidth;else if(De(e.drawWidth))parseInt(e.drawWidth)===+e.drawWidth&&(t=parseInt(e.drawWidth));else return n.value=e.drawWidth;return window.innerWidth<t?n.value="100%":n.value=t},gt=(t,l,s)=>{var k,T;if(t==null)return"";if(l.options){if(he(l.options))return((k=l.options.find(H=>H.value===t))==null?void 0:k.label)||t;if($e(l.options))return((T=l.options(t).find(H=>H.value===t))==null?void 0:T.label)||t}const y=Ve(e.columns,l.key);if(y.dbInfo.dataType==="date")return be(t).format(y.dbInfo.dateFormat);const g=I.value[l.key];return g&&g.selectSplit?t.join(g.selectSplit):t},bt=()=>$.value,ht=async(t,l,s,y)=>{e.isDebug&&console.groupCollapsed("onTableChange");try{if(C.current=t.current,y.action==="sort"){const g=wt(s,x);Oe(g)}if(y.action==="filter"){const g=It(l);Pe(g,!0)}if(y.action==="paginate"&&!await D(e.onPrePage)||(await ne(),y.action==="paginate"&&!await D(e.onPostPage)))return}catch(g){K(g)}e.isDebug&&console.groupEnd()},_t=async()=>{e.isDebug&&console.groupCollapsed("onToolbarRefresh"),c.list=!0;try{if(!await D(e.onBeforeRefresh)||(await ne(),!await D(e.onPostRefresh)))return}catch(t){K(t)}finally{b.value="List",c.list=!1,e.isDebug&&console.groupEnd()}},ne=async()=>{var t,l;e.isDebug&&console.groupCollapsed("loadData");try{c.list=!0;const s=x.filter(k=>k.index!=null).sort((k,T)=>k.index-T.index);e.isDebug&&console.log("sortConditions->",JSON.stringify(s)),e.isDebug&&console.log("whereConditions->",JSON.stringify(re));const g=(await r.post(e.url,de({actNo:"search",searchPar:JSON.stringify({sortConditions:s,whereConditions:[...re,...e.frozenFilterConditions],pageSize:C.pageSize,pageNum:C.current})}))).data;if(g.isSuccess){if(g.total>0&&g.records.length===0){let k=C.pageSize?Math.ceil(g.total/C.pageSize):1;if((C.current||1)>k){C.current=k,ne();return}}for(const k in X){const T=X[k];if(((t=T.dbInfo)==null?void 0:t.dataType)==="date")for(const H of g.records)nt(H,T.key,Q=>Q&&be(Q));else if(((l=T.editorInfo)==null?void 0:l.selectMode)==="multiple"){const H=I.value[T.key];if(H)for(const Q of g.records)nt(Q,T.key,Se=>Se&&Se.split(H.selectSplit))}}}else throw new Error(g.message||e.language.loadError);h.records=g.records||[],h.summary=g.summary||[],C.total=g.total||0,h.activeIndex=null,await D(e.onPostLoadData)}catch(s){throw h.records=[],C.total=0,h.activeIndex=null,s}finally{c.list=!1,e.isDebug&&console.groupEnd()}},wt=(t,l)=>{if(console.log("convertAntSortToSorterConditions"),l==null)return[];let s=l.reduce((g,k)=>k.index>g?k.index:g,0),y=t.length?t:[t];for(const g of l){const k=y.find(T=>T.columnKey===g.key);k==null||k.order==null?(g.index=null,g.order=null):(g.order=k.order,g.index==null&&(g.index=++s))}return it(l),l},kt=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarSort"),c.list=!0,c.draw=!0;try{if(!await D(e.onBeforeSort)||((t=N.value)==null||t.setSorter(x),b.value="Sort",!await D(e.onAfterSort)))return}catch(l){K(l)}finally{c.list=!1,c.draw=!1,e.isDebug&&console.groupEnd()}},Ct=async()=>{var t;e.isDebug&&console.log("sortSubmit"),c.draw=!0;try{if(!await D(e.onPreSort))return;const l=(t=N.value)==null?void 0:t.getSorter();if(Oe(l),await ne(),!await D(e.onPostSort))return;b.value="List"}catch(l){K(l)}finally{c.draw=!1}},Oe=t=>{const l=[];for(const s in G.value){const y=t.find(g=>g.key===s);y?l.push({key:s,index:y.index,order:y.order}):l.push({key:s,order:null,index:null})}it(l),e.toolbar.hasSort?ct($.value,l):ct($.value,[]),x=l,B.value=t.some(s=>s.order)},St=(t,l,s,y)=>{y.filteredValue=l,s()},xt=(t,l,s)=>{t(),s.filteredValue=[],l()},It=t=>{const l=[];for(const s in t){const y=t[s];if(y&&y.length){const g=L.value.find(T=>T.key===s);let k="eq";(g==null?void 0:g.componentType)==="input"&&(k="like"),l.push({key:s,opt:k,bool:"and",val:y.length===1?y[0]:y})}}return l},Ft=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarFilter"),c.list=!0,c.draw=!0;try{if(!await D(e.onBeforeFilter)||((t=V.value)==null||t.setConditions(re),b.value="Filter",!await D(e.onAfterFilter)))return}catch(l){K(l)}finally{c.draw=!1,c.list=!1,e.isDebug&&console.groupEnd()}},Dt=async()=>{var t;e.isDebug&&console.log("filterSubmit"),c.draw=!0;try{if(!await D(e.onPreFilter)||(Pe(((t=V.value)==null?void 0:t.getConditions())||[],!1),await ne(),!await D(e.onPostFilter)))return;b.value="List"}catch(l){K(l)}finally{c.draw=!1}},Et=async()=>{var t;(t=V.value)==null||t.setConditions([])},Tt=async(t,l)=>{const s=L.value.find(y=>y.key===t);s&&s.options&&$e(s.options)&&(s.attrs.options=await s.options(l))},At=()=>{for(const t of $.value)t.customFilterDropdown&&(t.filteredValue=[])},Pe=(t,l=!0)=>{var s;!l&&At(),(s=V.value)==null||s.setConditions(t),ue.value=!!t.length,re=t},Ot=()=>{var l;const t=h.curRecord;for(const s in I.value){const y=He(Ve(t,s));(l=z.value)==null||l.setEditorVal(s,y,!1,!0)}},Pt=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarEdit"),c.list=!0,c.draw=!0;try{if(h.activeIndex==null)throw e.language.selectRow;if(!await D(e.onBeforeEdit)||(Ot(),b.value="Edit",!await D(e.onAfterEdit)))return}catch(l){K(l)}finally{(t=z.value)==null||t.clearValidate(),c.list=!1,c.draw=!1,e.isDebug&&console.groupEnd()}},Rt=async()=>{var t;e.isDebug&&console.groupCollapsed("onToolbarAdd"),c.list=!0,c.draw=!0;try{if(!await D(e.onBeforeAdd)||((t=z.value)==null||t.clearEditor(),b.value="Add",!await D(e.onAfterAdd)))return}catch(l){K(l)}finally{c.list=!1,c.draw=!1,e.isDebug&&console.groupEnd()}},jt=async()=>{var t,l;e.isDebug&&console.groupCollapsed("addSubmit"),c.draw=!0;try{if(await((t=z.value)==null?void 0:t.validate().catch(y=>{if(y.errorFields&&y.errorFields.length)throw y.errorFields[0].errors[0]})),ae=(l=z.value)==null?void 0:l.getEditorVal(),!await D(e.onPreAddOrEdit)||!await D(e.onPreAdd))return;const s=await Vt();if(!await D(e.onPostAddOrEdit,s)||!await D(e.onPostAdd,s))return;Ce(e.language.addSuccess),b.value="List",await ne()}catch(s){K(s)}finally{c.draw=!1,e.isDebug&&console.groupEnd()}},Nt=async()=>{var t,l;e.isDebug&&console.groupCollapsed("editSubmit"),c.draw=!0;try{if(await((t=z.value)==null?void 0:t.validate().catch(y=>{if(y.errorFields&&y.errorFields.length)throw y.errorFields[0].errors[0]})),ae=(l=z.value)==null?void 0:l.getEditorVal(),!await D(e.onPreAddOrEdit)||!await D(e.onPreEdit))return;const s=await $t();if(!await D(e.onPostAddOrEdit,s)||!await D(e.onPostEdit,s))return;Ce(e.language.editSuccess),b.value="List",await ne()}catch(s){K(s)}finally{c.draw=!1,e.isDebug&&console.groupEnd()}},Vt=async()=>{e.isDebug&&console.log("insertData");const t=JSON.stringify(Ye(!1,!0,!0));if(t==="{}")throw e.language.noChange;const l=await r.post(e.url,de({actNo:"insert",record:t}));if(!l.data.isSuccess)throw l.data.message||e.language.addError;return l.data.record},$t=async()=>{e.isDebug&&console.log("updateData");const t=JSON.stringify(Ye(!0,!0,!0));if(t==="{}")throw e.language.noChange;const l=await r.post(e.url,de({actNo:"update",newRecord:t,oldRecord:JSON.stringify(Ge())}));if(!l.data.isSuccess)throw l.data.message||e.language.editError;return l.data.record},zt=()=>I.value,Mt=async()=>{e.isDebug&&console.groupCollapsed("onToolbarRemove"),c.list=!0;try{if(h.activeIndex==null)throw e.language.selectRow;if(!await D(e.onPreRemove)||(b.value="Remove",await Bt(),!await D(e.onPostRemove)))return;Ce(e.language.removeSuccess),b.value="List",await ne()}catch(t){K(t)}finally{c.list=!1,e.isDebug&&console.groupEnd()}},Bt=async()=>{e.isDebug&&console.log("removeData");const t=await r.post(e.url,de({actNo:"remove",record:JSON.stringify(Ge())}));if(!t.data.isSuccess)throw t.data.message||e.language.removeError},We=async t=>{e.isDebug&&console.groupCollapsed("onToolbarExport"),c.list=!0;try{if(!await D(e.onBeforeExport)||(await Yt(t),!await D(e.onAfterExport)))return}catch(l){K(l)}finally{c.list=!1,e.isDebug&&console.groupEnd()}},Yt=async t=>{var k;await D(e.onPreExport);const l=x.filter(T=>T.order!=null),s=`${e.tableTitle}(${be().format("YYYYMMDDHHmmss")})`,y=await r.post(e.url,de({actNo:"export",exportPar:JSON.stringify({sortConditions:l,whereConditions:[...re,...e.frozenFilterConditions],pageNum:C.current,pageSize:t?0:C.pageSize,cols:we,fileName:s})}),{responseType:"blob"});if((k=y.headers["content-type"])!=null&&k.toString().includes("application/json"))throw JSON.parse(await y.data.text()).Message||e.language.exportError;const g=new Blob([y.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});q.value.href=URL.createObjectURL(g),q.value.download=e.exportFileName?e.exportFileName():s,q.value.click(),await D(e.onPostExport)},Ut=async t=>{e.isDebug&&console.groupCollapsed("uploadFile"),c.list=!0;try{if(t==null)return;const l=new FormData;l.append("file",t),l.append("cols",JSON.stringify(U.map(g=>({key:g.key,title:g.title})))),l.append("actNo","import_file");const y=(await r.post(e.url,l)).data;if(y.isSuccess)ye.value=y.records,b.value="Import";else throw new Error(y.message||e.language.importFileError)}catch(l){K(l)}finally{c.list=!1,e.isDebug&&console.groupEnd()}},Lt=async()=>{e.isDebug&&console.groupCollapsed("importSubmit"),c.draw=!0;try{if(!await D(e.onPreImport,ye.value)||(await qt(),!await D(e.onPostImport,ye.value)))return;Ce(e.language.importSuccess),b.value="List",await ne()}catch(t){K(t)}finally{c.draw=!1,e.isDebug&&console.groupEnd()}},qt=async()=>{e.isDebug&&console.log("importData");const t=await r.post(e.url,de({actNo:"import",records:JSON.stringify(ye.value)}));if(!t.data.isSuccess)throw t.data.message||e.language.importError},Ht=async()=>{var s;const t=await r.post(e.url,de({actNo:"download_template",cols:JSON.stringify(U.map(y=>({key:y.key,title:y.title})))}),{responseType:"blob"});if((s=t.headers["content-type"])!=null&&s.toString().includes("application/json"))throw JSON.parse(await t.data.text()).Message||e.language.templateError;const l=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});q.value.href=URL.createObjectURL(l),q.value.download="template.xlsx",q.value.click()},Xe=()=>{e.isDebug&&console.log("init"),Ao(e);const t=Ro(e.columns),l=jo(e.columns,t),s=$o(e.columns),y=Mo(e.columns);we=No(e.columns),U=Vo(e.columns),X=Po(e.columns),e.toolbar.hasFilter&&Bo(y,l),I.value=t,L.value=l,G.value=s,$.value=y,Oe(e.initSorterConditions),Pe(e.initFilterConditions),U.length||(e.toolbar.hasImport=!1)},D=async(t,l)=>{if(t){const s=await t(l||{...h,editorRecord:Ye()});if(!s.isSuccess)return K(s.message||e.language.refreshError),!1;if(s.message){let y=!0;if(s.alertType==="alert"?await new Promise((g,k)=>{Ce(s.message,g)}):y=await new Promise((g,k)=>{Jt(g,s.message)}),!y)return!1}}return!0},Ye=(t=!1,l=!1,s=!1)=>{const y={},g=h.curRecord;try{for(const k in ae){let T=ae[k],H=t?Ve(g,k):T+"x";const Q=I.value[k];l&&Q.componentType==="select"&&Q.selectSplit&&(T!=null&&(T=T.length?T.join(Q.selectSplit):null),t&&H!=null&&(H=H.length?H.join(Q.selectSplit):null)),T+""!=H+""&&(s&&Q.isPost||!s)&&rt(y,k,T)}}catch(k){throw console.error(k),k}return y},Ge=()=>{var t;try{const l=h.curRecord,s=He(l);for(const y in X){const g=X[y],k=I.value[y];if(((t=g.editorInfo)==null?void 0:t.isPost)!==!1){let T=Ve(l,y);(k==null?void 0:k.componentType)==="select"&&(k!=null&&k.selectSplit)&&T!=null&&(T=T.length?T.join(k.selectSplit):null),rt(s,y,T)}}return s}catch(l){throw console.error(l),l}},Jt=(t,l)=>{Le.confirm({title:l,onOk(){t(!0)},onCancel(){t(!1)}})},K=t=>{Le.error({title:De(t)?t:t.message})},Ce=(t,l)=>{Le.info({title:De(t)?t:t.message,onOk(){l&&l(!0)}})},Kt=()=>{b.value=null};return Ke(()=>{Xe()}),po(async()=>{if(e.autoLoad)try{await ne()}catch(t){K(t)}}),(t,l)=>{const s=F("a-typography-title"),y=F("a-flex"),g=F("a-button"),k=F("a-space"),T=F("a-typography-text"),H=F("a-table"),Q=F("a-spin"),Se=F("a-drawer"),Wt=F("a-config-provider");return E(),j(Wt,{"component-size":e.size,locale:e.locale,theme:e.theme?{token:{colorPrimary:e.theme,colorBorderSecondary:e.theme,colorFillAlter:O(R),colorFillSecondary:O(R),colorBgContainerDisabled:"#F0F0F0"}}:{}},{default:d(()=>[f(H,{class:"ka-table",bordered:"","custom-row":yt,"row-class-name":vt,pagination:C.pageSize===0?!1:C,onChange:ht,loading:c.list,"data-source":h.records,showSorterTooltip:!1,columns:$.value,scroll:e.scroll},vo({summary:d(()=>[pe(t.$slots,"summaryBar",{summary:h.summary},void 0,!0)]),bodyCell:d(({text:W,column:ce,index:Re,record:je})=>[pe(t.$slots,"bodyItem",{column:ce,index:Re,text:W,record:je},()=>[ee(Z(gt(W,ce,je)),1)],!0)]),title:d(()=>[f(y,{class:"ka-table-title",justify:"space-between",align:"center"},{default:d(()=>[f(s,{level:4,style:{margin:"0"}},{default:d(()=>[ee(Z(e.tableTitle),1)]),_:1}),Ee("div",null,[f(Eo,{refresh:{isShow:e.toolbar.hasRefresh,title:e.refreshTitle||e.language.toolbarRefresh,onClick:_t},filter:{isShow:e.toolbar.hasFilter,title:e.filterTitle||e.language.toolbarFilter,isActive:ue.value,onClick:Ft},export:{isShow:e.toolbar.hasExport,title:e.exportTitle||e.language.toolbarExport,onExportAll(W){We(!0)},onExportPage(W){We(!1)}},sort:{isActive:B.value,isShow:e.toolbar.hasSort,title:e.sortTitle||e.language.toolbarSort,onClick:kt},add:{isShow:e.toolbar.hasAdd,title:e.addTitle||e.language.toolbarAdd,onClick:Rt},import:{isShow:e.toolbar.hasImport,title:e.importTitle||e.language.toolbarImport,beforeUpload:Ut,downloadTemplate:Ht},edit:{isDisabled:h.activeIndex==null,isShow:e.toolbar.hasEdit,title:e.editTitle||e.language.toolbarEdit,onClick:Pt},remove:{isShow:e.toolbar.hasRemove,title:e.removeTitle||e.language.toolbarRemove,isDisabled:h.activeIndex==null,onClick:Mt},"activate-color":O(p)},{toolbar:d(()=>[pe(t.$slots,"toolbar",{dataSource:h},void 0,!0)]),_:3},8,["refresh","filter","export","sort","add","import","edit","remove","activate-color"])])]),_:3})]),customFilterDropdown:d(({setSelectedKeys:W,selectedKeys:ce,confirm:Re,clearFilters:je,column:ve})=>[Ee("div",qo,[f(k,{direction:"vertical",style:{width:"100%"}},{default:d(()=>{var Qe,Ze,et;return[f(ze,Te({value:ce[0],onChange:le=>{W(le?[le]:[])},onSearch:le=>Tt(ve.key,le),"component-type":(Qe=L.value.find(le=>le.key===ve.key))==null?void 0:Qe.componentType},(Ze=L.value.find(le=>le.key===ve.key))==null?void 0:Ze.attrs,{style:{width:(et=L.value.find(le=>le.key===ve.key))==null?void 0:et.width}}),null,16,["value","onChange","onSearch","component-type","style"]),f(y,{justify:"space-between",align:"center"},{default:d(()=>[f(g,{onClick:le=>St(W,ce,Re,ve),type:"primary"},{default:d(()=>[ee(Z(e.language.toolbarFilter),1)]),_:2},1032,["onClick"]),f(g,{onClick:le=>xt(je,Re,ve)},{default:d(()=>[ee(Z(e.language.reset),1)]),_:2},1032,["onClick"])]),_:2},1024)]}),_:2},1024)])]),customFilterIcon:d(({filtered:W})=>[f(O(ut),{style:_e({color:W?e.theme:void 0})},null,8,["style"])]),headerCell:d(({column:W})=>[f(y,{justify:"space-between",align:"center"},{default:d(()=>[Ee("span",null,Z(W.title),1),se(f(T,{type:"secondary"},{default:d(()=>[ee(Z(W.sorter.multiple),1)]),_:2},1536),[[ie,W.sortOrder]])]),_:2},1024)]),_:2},[Fe(t.$slots,(W,ce)=>({name:ce,fn:d(()=>[pe(t.$slots,ce,{},void 0,!0)])}))]),1032,["pagination","loading","data-source","columns","scroll"]),f(Se,{title:Y.value,open:oe.value,width:n.value,onClose:Kt,class:"ka-table-drawer",closable:!c.draw,"mask-closable":!1,"force-render":!0,"header-style":{"padding-top":"8px","padding-bottom":"8px"},"body-style":{"padding-top":"8px","padding-bottom":"8px"}},{extra:d(()=>[f(k,null,{default:d(()=>[se(f(g,{onClick:_.value,loading:c.draw,size:"normal"},{default:d(()=>[ee(Z(e.drawClearTitle||e.language.clear),1)]),_:1},8,["onClick","loading"]),[[ie,!!_.value]]),se(f(g,{type:"primary",onClick:w.value,loading:c.draw,size:"normal"},{default:d(()=>[ee(Z(e.drawSubmitTitle||e.language.confirm),1)]),_:1},8,["onClick","loading"]),[[ie,!!w.value]])]),_:1})]),default:d(()=>[f(Q,{spinning:c.draw},{default:d(()=>[e.toolbar.hasSort?se((E(),j(Lo,{key:0,ref_key:"$sorter",ref:N,"col-obj":G.value},null,8,["col-obj"])),[[ie,b.value==="Sort"]]):te("",!0),e.toolbar.hasFilter?se((E(),j(Fo,{key:1,columns:L.value,ref_key:"$filter",ref:V},null,8,["columns"])),[[ie,b.value==="Filter"]]):te("",!0),e.toolbar.hasAdd||e.toolbar.hasEdit?se((E(),j(xo,{key:2,ref_key:"$form",ref:z,"items-obj":I.value},null,8,["items-obj"])),[[ie,["Add","Edit"].includes(b.value)]]):te("",!0),e.toolbar.hasImport?se((E(),j(H,{key:3,bordered:"",columns:O(U),dataSource:ye.value,pagination:!1},{footer:d(()=>[ee(Z(e.language.summaryTotal)+": "+Z(ye.value.length),1)]),_:1},8,["columns","dataSource"])),[[ie,b.value==="Import"]]):te("",!0)]),_:1},8,["spinning"])]),_:1},8,["title","open","width","closable"]),e.toolbar.hasExport?(E(),fe("a",{key:0,ref_key:"$export",ref:q,style:{display:"none"}},null,512)):te("",!0)]),_:3},8,["component-size","locale","theme"])}}}),Xo=Me(Ho,[["__scopeId","data-v-74b653f8"]]);export{Xo as K};
