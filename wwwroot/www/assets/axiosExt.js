import{cb as c}from"./vendor.js";import{p as n}from"./pinia.js";import{u as i}from"./storage.js";import{E as o}from"./json-data.js";let s;const t=c.create();t.interceptors.request.use(e=>{s||(s=i(n));const a=s.userToken;return e.headers.Authorization=`Bearer ${a}`,e},e=>Promise.reject(e.data.error.message));t.interceptors.response.use(e=>e,async e=>{var r;const a=e.config;if(((r=e.response)==null?void 0:r.status)===401&&e.response.data)if(e.response.data.code===o.AuthenticateTokenExpired)try{return await s.refreshToken(),s.isLogged?await t(a):(e.response.data={isSuccess:!1,message:"请重新登录",code:o.Success},e.response)}catch{return s.isLogged=!1,e.response.data={isSuccess:!1,message:"刷新失败，请重新登录",code:o.Success},e.response}else return s.isLogged=!1,e.response.data={isSuccess:!1,message:"刷新失败，请重新登录",code:o.Success},e.response;return e.response.data={isSuccess:!1,message:e.message,code:o.Success},e.response});export{t as $};
