import{d as C,E as m,r as v,c as I,w as K,b as g,j as R,o as P,f as _,u as f,k as U,v as j}from"../vendor.js";import{K as A}from"../ka-table.js";import{K as E,s as h}from"../KaUpload.js";import{$ as y}from"../axiosExt.js";import"../ant-design-vue.js";import"../Home.js";import"../pinia.js";import"../storage.js";import"../lang.js";import"../json-data.js";const J=C({__name:"UploadReport",setup(T){const{lang:r}=g("lang"),p=g("loading"),o=m(""),d=m("");let l=!1;const w={hasExport:!1,hasRemove:!1,hasEdit:!1,hasAdd:!1},x={snKey:{title:"SN",dbInfo:{isPk:!0},listInfo:{index:1,width:"150px"},sortInfo:{index:null}},modifyAt:{title:r.value.util.修改时间,listInfo:{index:7},dbInfo:{dataType:"date"},sortInfo:{index:null}}},b=v(),i=v([]),k=async a=>{var n;p.value=!0;const e=(n=a.curRecord)==null?void 0:n.snKey;o.value=e;try{const s=(await y.post("/api/fieldPic/pics/",e,{headers:{"Content-Type":"application/json"}})).data;if(s.isSuccess)d.value=s.message,s.records?i.value=s.records.map(c=>({uid:c,name:c,url:`/files/field/${s.message}/${c}`,state:"done"})):i.value=[];else throw s.message}catch(t){h(t)}finally{p.value=!1}return{isSuccess:!0}},$=(a,e)=>{l||(l=!0,u())},S=(a,e)=>{l||(l=!0,u())},u=async()=>{if(o.value)try{const e=(await y.post("/api/fieldPic/log",o.value,{headers:{"Content-Type":"application/json"}})).data;if(!e.isSuccess)throw e.message}catch(a){h(a)}};return(a,e)=>{const n=R("a-flex");return P(),I(n,{gap:"middle"},{default:K(()=>[_(f(A),{ref_key:"$table",ref:b,"table-title":f(r).field.外勤,size:"small",columns:x,toolbar:w,url:"/api/fieldpic/table","on-after-row-click":k,"init-sorter-conditions":[{key:"modifyAt",index:1,order:"descend"}],"is-debug":!1,"default-lang":f(r).lang},null,8,["table-title","default-lang"]),U(_(E,{"file-list":i.value,"onUpdate:fileList":e[0]||(e[0]=t=>i.value=t),action:"/api/fieldpic/upload",data:{sn:d.value},"remove-data":t=>`${d.value}/${t.name}`,"remove-url":"/api/fieldpic/del",onPostRemove:S,onPostUpload:$},null,8,["file-list","data","remove-data"]),[[j,!!o.value]])]),_:1})}}});export{J as default};
