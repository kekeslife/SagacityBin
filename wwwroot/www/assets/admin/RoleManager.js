import{K as f}from"../ka-table.js";import{E as r}from"../util.js";import{v as w}from"../KaUpload.js";import{$ as h}from"../axiosExt.js";import{d as g,r as d,c as _,w as y,b as N,j as R,o as T,f as m,u as n}from"../vendor.js";import"../ant-design-vue.js";import"../Home.js";import"../pinia.js";import"../storage.js";import"../lang.js";import"../json-data.js";const V=g({__name:"RoleManager",setup(k){const{lang:e}=N("lang"),s=d([]),u={hasExport:!1,hasRemove:!1},v={roleNo:{title:e.value.admin.权限组代码,dbInfo:{isPk:!0},listInfo:{index:1,width:"150px"},editorInfo:{index:1,width:"300px",rules:[{required:!0,validator:o}]}},roleDesc:{title:e.value.admin.权限组名称,listInfo:{index:2,width:"200px"},sortInfo:{index:null},editorInfo:{index:2,width:"300px",rules:[{required:!0,validator:o}]}},state:{title:e.value.util.状态,listInfo:{index:6,width:"80px",options:[{label:e.value.util.启用,value:r.Y},{label:e.value.util.停用,value:r.N}]},editorInfo:{index:6,componentType:"select",width:"100px",rules:[{required:!0,validator:o}]}},modifyAt:{title:e.value.util.修改时间,listInfo:{index:7},dbInfo:{dataType:"date"}},modifier:{userName:{title:e.value.util.修改人,listInfo:{width:"100px",index:8}}}},x={roleNo:{title:e.value.admin.权限组代码,dbInfo:{isPk:!0},listInfo:{index:1,width:"150px"},editorInfo:{index:2,width:"300px",rules:[{required:!0,validator:o}]}},programId:{title:e.value.admin.程序名称,editorInfo:{index:2,width:"300px",rules:[{required:!0,validator:o}],componentType:"select",options:s.value}},program:{programDesc:{title:e.value.admin.程序名称,listInfo:{index:2,width:"200px"}}},state:{title:e.value.util.状态,listInfo:{index:6,width:"80px",options:[{label:e.value.util.启用,value:r.Y},{label:e.value.util.停用,value:r.N}]},editorInfo:{index:6,componentType:"select",width:"100px",rules:[{required:!0,validator:o}]}},modifyAt:{title:e.value.util.修改时间,listInfo:{index:7},dbInfo:{dataType:"date"}},modifier:{userName:{title:e.value.util.修改人,listInfo:{width:"100px",index:8}}}},c=d(),i=d(),b=async t=>{var a,p;(a=i.value)==null||a.setFilters([{key:"roleNo",opt:"eq",val:t.curRecord.roleNo,bool:"and"}]),await((p=i.value)==null?void 0:p.reloadData());const l=await h.get(`/api/adminRole/remainPrograms/${t.curRecord.roleNo}`);return l.data.isSuccess&&s.value.splice(0,s.value.length,...l.data.records),{isSuccess:!0}},I=async()=>{var l,a;const t=(l=c.value)==null?void 0:l.getData();return t!=null&&t.curRecord&&await((a=i.value)==null?void 0:a.setEditorVal("roleNo",t.curRecord.roleNo)),{isSuccess:!0}};async function o(t,l){return w(e.value.validate,l)}return(t,l)=>{const a=R("a-flex");return T(),_(a,{vertical:"",gap:"middle"},{default:y(()=>[m(n(f),{ref_key:"$roleTable",ref:c,"table-title":n(e).admin.权限组,size:"small",columns:v,toolbar:u,url:"/api/adminRole/roles","on-after-row-click":b,"is-debug":!1},null,8,["table-title"]),m(n(f),{ref_key:"$programTable",ref:i,"table-title":n(e).admin.程序,columns:x,toolbar:u,url:"/api/adminRole/programs","auto-load":!1,"on-after-add":I,"is-debug":!1},null,8,["table-title"])]),_:1})}}});export{V as default};
